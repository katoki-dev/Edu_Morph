<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EDU-MORPH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="navigation.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #3B82F6 0%, #9333EA 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Flashcard Flip Animation */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            height: 400px;
        }
        
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flashcard-container.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: linear-gradient(135deg, #374151 0%, #4B5563 100%);
            border-radius: 12px;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
        }
        
        .flashcard-container:hover .flashcard-inner {
            transform: scale(1.02);
        }
        
        .flashcard-container.flipped:hover .flashcard-inner {
            transform: rotateY(180deg) scale(1.02);
        }
        
        
        
        /* Loading Animations */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3B82F6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        
        /* Keyboard Shortcut Hints */
        .keyboard-hint {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            position: absolute;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="app">

        <!-- Navigation -->
        <div id="navigation-container"></div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- New Student Notification -->
            <div v-if="newStudentNotification" class="mb-4 p-4 bg-green-600 text-white rounded-lg flex items-center justify-between">
                <span>{{ newStudentNotification }}</span>
                <button @click="newStudentNotification = null" class="text-white hover:text-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Welcome Banner -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-8 mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Welcome back, {{ userName }}!</h1>
                <p class="text-blue-100">Ready to continue your adaptive learning journey?</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-500 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-400">Courses Completed</p>
                            <p class="text-2xl font-semibold text-white">{{ userStats.coursesCompleted }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-500 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-400">Current Streak</p>
                            <p class="text-2xl font-semibold text-white">{{ userStats.currentStreak }} days</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="flex items-center">
                        <div class="p-3 bg-purple-500 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-400">Learning Points</p>
                            <p class="text-2xl font-semibold text-white">{{ userStats.learningPoints.toLocaleString() }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role-Specific Modules -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Student Modules -->
                <div v-if="user && user.role === 'student'" class="space-y-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Student Tools</h3>
                    
                    <!-- Take Test Section -->
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Take Test</h4>
                        <div class="flex items-center space-x-4">
                            <input v-model="testCodeInput" type="text" placeholder="Enter test code" 
                                   class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <button @click="joinTest" 
                                    :disabled="!testCodeInput.trim()"
                                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:shadow-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                Join Test
                            </button>
                        </div>
                        <p class="text-gray-400 text-sm mt-2">Enter the test code provided by your educator</p>
                    </div>
                    
                    <!-- Flash Cards -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('flashcards')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Flash Cards</h4>
                                <p class="text-gray-400">Interactive learning with flash cards</p>
                            </div>
                        </div>
                    </div>

                    <!-- Test Page -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('test-page')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Test Page</h4>
                                <p class="text-gray-400">Take tests assigned by educators</p>
                            </div>
                        </div>
                    </div>

                    <!-- Result Page -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('result-page')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Result Page</h4>
                                <p class="text-gray-400">View your test results and progress</p>
                            </div>
                        </div>
                    </div>

                    <!-- Resources -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('resources')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Resources</h4>
                                <p class="text-gray-400">Access learning materials and resources</p>
                                <p class="text-sm text-blue-400 mt-1">{{ resources.length }} files available</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Chatbot -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('chatbot')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">AI Chatbot</h4>
                                <p class="text-gray-400">Get instant help with AI assistant</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Educator Modules -->
                <div v-if="user && user.role === 'educator'" class="space-y-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Educator Tools</h3>
                    
                    <!-- AI Test Paper Making -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('ai-test-maker')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">AI Test Paper Making</h4>
                                <p class="text-gray-400">Generate intelligent test papers using AI</p>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Analysis -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('performance-analysis')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Performance Analysis</h4>
                                <p class="text-gray-400">Analyze student performance and insights</p>
                            </div>
                        </div>
                    </div>

                    <!-- Student Management -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('student-management')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Student Management</h4>
                                <p class="text-gray-400">Manage and track student progress</p>
                            </div>
                        </div>
                    </div>

                    <!-- Course Planner -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('course-planner')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Course Planner</h4>
                                <p class="text-gray-400">Plan next courses and classes</p>
                            </div>
                        </div>
                    </div>

                    <!-- Resource Upload -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('resource-upload')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Resource Upload</h4>
                                <p class="text-gray-400">Upload and manage educational resources</p>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Question Creator -->
                    <div class="bg-gray-800 p-6 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="openModule('custom-question-creator')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-white">Custom Question Creator</h4>
                                <p class="text-gray-400">Create custom question papers and quizzes</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Educator Tools -->
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold text-white mb-4">Advanced Educator Tools</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Class Management -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showClassManagement = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Class Management</h5>
                                        <p class="text-xs text-gray-400">Manage student groups</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Assignment System -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showAssignmentSystem = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Assignment System</h5>
                                        <p class="text-xs text-gray-400">Assign flashcards to students</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Progress Monitoring -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showProgressMonitoring = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Progress Monitoring</h5>
                                        <p class="text-xs text-gray-400">Track student progress</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Bulk Operations -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showBulkOperations = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Bulk Operations</h5>
                                        <p class="text-xs text-gray-400">Manage multiple students</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Report Generation -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showReportGeneration = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Report Generation</h5>
                                        <p class="text-xs text-gray-400">Generate detailed reports</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Flash Cards Management -->
                            <div class="bg-gray-800 p-4 rounded-lg hover:bg-gray-750 transition-colors cursor-pointer" @click="showFlashcards = true">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-medium text-white">Flash Cards</h5>
                                        <p class="text-xs text-gray-400">Create and manage flashcards</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="space-y-6">
                    <h3 class="text-xl font-semibold text-white mb-4">Analytics</h3>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-white mb-4">Learning Progress</h3>
                        <div class="h-64">
                            <canvas id="learningProgressChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-white mb-4">Subject Distribution</h3>
                        <div class="h-64">
                            <canvas id="subjectDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Settings Modal -->
        <div v-if="showProfileSettings" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Profile Settings</h3>
                    <button @click="showProfileSettings = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form @submit.prevent="updateProfile">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300">First Name</label>
                            <input v-model="profileForm.firstName" type="text" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Last Name</label>
                            <input v-model="profileForm.lastName" type="text" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Email</label>
                            <input v-model="profileForm.email" type="email" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Role</label>
                            <div class="mt-1 block w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-300 cursor-not-allowed">
                                {{ profileForm.role === 'student' ? 'Student' : 'Educator' }}
                            </div>
                            <p class="text-xs text-gray-400 mt-1">Role cannot be changed after signup</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button @click="showProfileSettings = false" type="button" class="px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Account Settings Modal -->
        <div v-if="showAccountSettings" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Account Settings</h3>
                    <button @click="showAccountSettings = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="text-lg font-medium text-white mb-4">Change Password</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-300">Current Password</label>
                                <input v-model="passwordForm.currentPassword" type="password" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300">New Password</label>
                                <input v-model="passwordForm.newPassword" type="password" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300">Confirm New Password</label>
                                <input v-model="passwordForm.confirmPassword" type="password" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-700">
                        <h4 class="text-lg font-medium text-red-400 mb-4">Danger Zone</h4>
                        <button @click="deleteAccount" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700">
                            Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Test Paper Making Modal -->
        <div v-if="showAITestMaker" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">AI Test Paper Making</h3>
                    <button @click="showAITestMaker = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Test Configuration -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                            <input v-model="testConfig.subject" type="text" placeholder="e.g., Engineering Mechanics, Thermodynamics, Circuit Analysis" 
                                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty</label>
                            <select v-model="testConfig.difficulty" 
                                    class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="Easy">Easy</option>
                                <option value="Medium">Medium</option>
                                <option value="Hard">Hard</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Questions</label>
                            <select v-model="testConfig.count" 
                                    class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="5">5 Questions</option>
                                <option value="10">10 Questions</option>
                                <option value="15">15 Questions</option>
                                <option value="20">20 Questions</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Time Limit (min)</label>
                            <input v-model="testConfig.timeLimit" type="number" placeholder="60" 
                                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="flex justify-center">
                        <button @click="generateTestQuestions" 
                                :disabled="isGeneratingQuestions || !testConfig.subject.trim()"
                                class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:shadow-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span v-if="isGeneratingQuestions">Generating Questions...</span>
                            <span v-else>Generate Test Questions</span>
                        </button>
                    </div>

                    <!-- Generated Questions -->
                    <div v-if="generatedQuestions.length > 0" class="mt-6">
                        <h4 class="text-lg font-medium text-white mb-4">Generated Questions</h4>
                        <div class="space-y-4">
                            <div v-for="(question, index) in generatedQuestions" :key="question.id" 
                                 class="bg-gray-700 p-4 rounded-lg">
                                <p class="text-white font-medium mb-3">{{ question.id }}. {{ question.question }}</p>
                                <div class="space-y-2">
                                    <div v-for="(option, optIndex) in question.options" :key="optIndex" 
                                         class="flex items-center space-x-2">
                                        <span class="text-gray-300">{{ String.fromCharCode(65 + optIndex) }}) {{ option }}</span>
                                    </div>
                                </div>
                                <p class="text-green-400 text-sm mt-2">Correct Answer: {{ question.correctAnswer }}</p>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="mt-6 flex justify-center space-x-4">
                            <button @click="saveTest" 
                                    class="px-6 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:shadow-lg transition-all duration-300">
                                Save Test
                            </button>
                            <button @click="publishTest" 
                                    class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:shadow-lg transition-all duration-300">
                                Publish Test
                            </button>
                            <button @click="previewTest" 
                                    class="px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:shadow-lg transition-all duration-300">
                                Preview Test
                            </button>
                        </div>
                    </div>

                    <!-- Test Code Display -->
                    <div v-if="showTestCode" class="mt-6 bg-green-900 border border-green-700 text-green-200 px-4 py-3 rounded">
                        <h4 class="text-lg font-medium mb-2">Test Published Successfully!</h4>
                        <p class="mb-2">Share this code with your students to take the test:</p>
                        <div class="flex items-center space-x-2">
                            <input :value="testCode" readonly 
                                   class="flex-1 px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white font-mono text-lg">
                            <button @click="copyTestCode" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                Copy Code
                            </button>
                        </div>
                        <p class="text-sm mt-2 text-green-300">Students can use this code to access the test</p>
                    </div>

                    <!-- Published Tests List -->
                    <div v-if="publishedTests.length > 0" class="mt-6">
                        <h4 class="text-lg font-medium text-white mb-4">Published Tests</h4>
                        <div class="space-y-3">
                            <div v-for="test in publishedTests" :key="test.id" 
                                 class="bg-gray-700 p-4 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="text-white font-medium">{{ test.title }}</h5>
                                        <p class="text-gray-400 text-sm">{{ test.subject }} • {{ test.difficulty }} • {{ test.questions.length }} questions</p>
                                        <p class="text-gray-400 text-sm">Time Limit: {{ test.timeLimit }} minutes</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-green-400 font-mono text-lg">{{ test.code }}</p>
                                        <p class="text-gray-400 text-sm">Test Code</p>
                                    </div>
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button @click="copyTestCode(test.code)" 
                                            class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                        Copy Code
                                    </button>
                                    <button @click="viewTestResults(test)" 
                                            class="px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700">
                                        View Results
                                    </button>
                                    <button @click="unpublishTest(test)" 
                                            class="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                        Unpublish
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Error Message -->
                    <div v-if="testError" class="bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded">
                        {{ testError }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Analysis Modal -->
        <div v-if="showPerformanceAnalysis" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Performance Analysis</h3>
                    <button @click="showPerformanceAnalysis = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Summary Cards -->
                    <div class="space-y-4">
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <h4 class="text-lg font-medium text-white mb-2">Overall Performance</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-gray-400 text-sm">Average Score</p>
                                    <p class="text-2xl font-bold text-green-400">{{ performanceData.averageScore }}%</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Total Tests</p>
                                    <p class="text-2xl font-bold text-blue-400">{{ performanceData.totalTests }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 p-4 rounded-lg">
                            <h4 class="text-lg font-medium text-white mb-2">Improvement Rate</h4>
                            <div class="flex items-center space-x-2">
                                <div class="w-full bg-gray-600 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full" 
                                         :style="{width: performanceData.improvementRate + '%'}"></div>
                                </div>
                                <span class="text-white font-medium">{{ performanceData.improvementRate }}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Performance Chart -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Student Performance</h4>
                        <div class="h-64">
                            <canvas id="studentPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Student List -->
                <div class="mt-6">
                    <h4 class="text-lg font-medium text-white mb-4">Student Details</h4>
                    <div class="bg-gray-700 rounded-lg overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-600">
                                <tr>
                                    <th class="px-4 py-3 text-left text-white font-medium">Student Name</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Last Score</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Average</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Tests Taken</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="student in performanceData.students" :key="student.id" class="border-t border-gray-600">
                                    <td class="px-4 py-3 text-white">{{ student.name }}</td>
                                    <td class="px-4 py-3 text-white">{{ student.lastScore }}%</td>
                                    <td class="px-4 py-3 text-white">{{ student.average }}%</td>
                                    <td class="px-4 py-3 text-white">{{ student.testsTaken }}</td>
                                    <td class="px-4 py-3">
                                        <span :class="student.status === 'Excellent' ? 'text-green-400' : student.status === 'Good' ? 'text-blue-400' : 'text-yellow-400'" 
                                              class="font-medium">{{ student.status }}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Management Modal -->
        <div v-if="showStudentManagement" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-lg font-medium text-white">Student Management</h3>
                        <button @click="loadStudentsFromDatabase" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">
                            🔄 Refresh
                        </button>
                        <span class="text-gray-400 text-sm">Auto-updates every 30s</span>
                    </div>
                    <button @click="showStudentManagement = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Add Student Form -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Add New Student</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input v-model="newStudent.firstName" type="text" placeholder="First Name" 
                                   class="px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            <input v-model="newStudent.lastName" type="text" placeholder="Last Name" 
                                   class="px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            <input v-model="newStudent.email" type="email" placeholder="Email" 
                                   class="px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                        </div>
                        <button @click="addStudent" 
                                :disabled="!newStudent.firstName.trim() || !newStudent.lastName.trim() || !newStudent.email.trim()"
                                class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            Add Student
                        </button>
                    </div>
                    
                    <!-- Student List -->
                    <div class="bg-gray-700 rounded-lg overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-600">
                                <tr>
                                    <th class="px-4 py-3 text-left text-white font-medium">Name</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Email</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Progress</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Last Active</th>
                                    <th class="px-4 py-3 text-left text-white font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="student in students" :key="student.id" class="border-t border-gray-600">
                                    <td class="px-4 py-3 text-white">{{ student.name }}</td>
                                    <td class="px-4 py-3 text-white">{{ student.email }}</td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-600 rounded-full h-2">
                                                <div class="bg-green-500 h-2 rounded-full" :style="{width: student.progress + '%'}"></div>
                                            </div>
                                            <span class="text-white text-sm">{{ student.progress }}%</span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-white">{{ student.lastActive }}</td>
                                    <td class="px-4 py-3">
                                        <div class="flex space-x-2">
                                            <button @click="viewStudent(student)" class="text-blue-400 hover:text-blue-300">View</button>
                                            <button @click="editStudent(student)" class="text-yellow-400 hover:text-yellow-300">Edit</button>
                                            <button @click="deleteStudent(student)" class="text-red-400 hover:text-red-300">Remove</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Planner Modal -->
        <div v-if="showCoursePlanner" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Course Planner</h3>
                    <button @click="showCoursePlanner = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Course Plan Form -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Create New Course Plan</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Course Title</label>
                                <input v-model="coursePlan.title" type="text" placeholder="e.g., Engineering Mechanics, Thermodynamics, Circuit Analysis" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea v-model="coursePlan.description" rows="3" placeholder="Engineering course description covering theory, applications, and practical examples..." 
                                          class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500"></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Start Date</label>
                                    <input v-model="coursePlan.startDate" type="date" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">End Date</label>
                                    <input v-model="coursePlan.endDate" type="date" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        <button @click="createCoursePlan" 
                                :disabled="!coursePlan.title.trim() || !coursePlan.description.trim()"
                                class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            Create Course Plan
                        </button>
                    </div>
                    
                    <!-- Course Calendar -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Course Schedule</h4>
                        <div class="grid grid-cols-7 gap-2">
                            <div class="text-center text-gray-400 font-medium py-2">Mon</div>
                            <div class="text-center text-gray-400 font-medium py-2">Tue</div>
                            <div class="text-center text-gray-400 font-medium py-2">Wed</div>
                            <div class="text-center text-gray-400 font-medium py-2">Thu</div>
                            <div class="text-center text-gray-400 font-medium py-2">Fri</div>
                            <div class="text-center text-gray-400 font-medium py-2">Sat</div>
                            <div class="text-center text-gray-400 font-medium py-2">Sun</div>
                            
                            <div v-for="day in 28" :key="day" 
                                 class="h-16 bg-gray-600 rounded border border-gray-500 flex items-center justify-center text-white hover:bg-gray-500 cursor-pointer">
                                {{ day }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resource Upload Modal -->
        <div v-if="showResourceUpload" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Resource Upload</h3>
                    <button @click="showResourceUpload = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Upload Area -->
                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center" 
                         @dragover.prevent 
                         @drop.prevent="handleFileDrop"
                         :class="{'border-blue-500 bg-blue-900 bg-opacity-20': isDragOver}"
                         @dragenter="isDragOver = true"
                         @dragleave="isDragOver = false">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="mt-4">
                            <label for="file-upload" class="cursor-pointer">
                                <span class="mt-2 block text-sm font-medium text-white">Upload files</span>
                                <span class="mt-1 block text-sm text-gray-400">or drag and drop</span>
                                <input id="file-upload" name="file-upload" type="file" class="sr-only" multiple 
                                       @change="handleFileSelect" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif">
                            </label>
                        </div>
                        <p class="mt-2 text-xs text-gray-400">PDF, DOC, PPT, images up to 10MB each</p>
                    </div>
                    
                    <!-- Upload Progress -->
                    <div v-if="uploadProgress > 0" class="bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between text-sm text-white mb-2">
                            <span>Uploading...</span>
                            <span>{{ uploadProgress }}%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" :style="{width: uploadProgress + '%'}"></div>
                        </div>
                    </div>
                    
                    <!-- Uploaded Files -->
                    <div v-if="uploadedFiles.length > 0" class="bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-medium text-white">Uploaded Files</h4>
                            <div class="flex space-x-2">
                                <button @click="clearAllFiles" class="text-red-400 hover:text-red-300 text-sm">
                                    Clear All Files
                                </button>
                                <button @click="forceClearAllFiles" class="text-red-600 hover:text-red-400 text-sm font-bold">
                                    Force Clear All
                                </button>
                                <button @click="nuclearClear" class="text-red-800 hover:text-red-600 text-sm font-bold bg-red-900 px-2 py-1 rounded">
                                    NUCLEAR
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div v-for="file in uploadedFiles" :key="file.id" 
                                 class="flex items-center justify-between p-3 bg-gray-600 rounded">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <span class="text-white">{{ file.name }}</span>
                                    <span class="text-gray-400 text-sm">{{ file.size }}</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="downloadFile(file)" class="text-blue-400 hover:text-blue-300">Download</button>
                                    <button @click="deleteFile(file)" class="text-red-400 hover:text-red-300">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Question Creator Modal -->
        <div v-if="showCustomQuestionCreator" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Custom Question Creator</h3>
                    <button @click="showCustomQuestionCreator = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Test Configuration -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Test Configuration</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Test Title</label>
                                <input v-model="customTestConfig.title" type="text" placeholder="Enter test title" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                                <input v-model="customTestConfig.subject" type="text" placeholder="Enter subject" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty</label>
                                <select v-model="customTestConfig.difficulty" 
                                        class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Hard">Hard</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Time Limit (minutes)</label>
                                <input v-model.number="customTestConfig.timeLimit" type="number" placeholder="60" 
                                       class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Add Question Form -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Add Question</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Question Text</label>
                                <textarea v-model="newQuestion.question" rows="3" placeholder="Enter your question here..." 
                                          class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500"></textarea>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Option A</label>
                                    <input v-model="newQuestion.options[0]" type="text" placeholder="Option A" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Option B</label>
                                    <input v-model="newQuestion.options[1]" type="text" placeholder="Option B" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Option C</label>
                                    <input v-model="newQuestion.options[2]" type="text" placeholder="Option C" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Option D</label>
                                    <input v-model="newQuestion.options[3]" type="text" placeholder="Option D" 
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Correct Answer</label>
                                <select v-model="newQuestion.correctAnswer" 
                                        class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                                    <option value="">Select correct answer</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            
                            <div class="flex justify-end space-x-2">
                                <button @click="clearNewQuestion" 
                                        class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                                    Clear
                                </button>
                                <button @click="addCustomQuestion" 
                                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    Add Question
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Questions List -->
                    <div v-if="customQuestions.length > 0" class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-lg font-medium text-white mb-4">Custom Questions ({{ customQuestions.length }})</h4>
                        <div class="space-y-4">
                            <div v-for="(question, index) in customQuestions" :key="question.id" 
                                 class="bg-gray-600 p-4 rounded-lg">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-white font-medium">{{ index + 1 }}. {{ question.question }}</p>
                                    <button @click="removeCustomQuestion(index)" 
                                            class="text-red-400 hover:text-red-300">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div class="space-y-1">
                                    <div v-for="(option, optIndex) in question.options" :key="optIndex" 
                                         class="flex items-center space-x-2">
                                        <span class="text-gray-300">{{ String.fromCharCode(65 + optIndex) }}) {{ option }}</span>
                                        <span v-if="question.correctAnswer === String.fromCharCode(65 + optIndex)" 
                                              class="text-green-400 text-sm">✓</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div v-if="customQuestions.length > 0" class="flex justify-center space-x-4">
                        <button @click="previewCustomTest" 
                                class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            Preview Test
                        </button>
                        <button @click="saveCustomTest" 
                                class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Save Test
                        </button>
                        <button @click="publishCustomTest" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Publish Test
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resources Modal (for Students) -->
        <div v-if="showResources" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Educational Resources</h3>
                    <button @click="showResources = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <!-- Search and Filter -->
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="flex-1">
                            <input v-model="resourceSearch" type="text" placeholder="Search resources..." 
                                   class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <select v-model="resourceFilter" 
                                class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Types</option>
                            <option value="PDF">PDF</option>
                            <option value="DOC">DOC</option>
                            <option value="PPT">PPT</option>
                            <option value="JPG">JPG</option>
                            <option value="PNG">PNG</option>
                        </select>
                    </div>
                    
                    <!-- Resources List -->
                    <div v-if="filteredResources.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="resource in filteredResources" :key="resource.id" 
                             class="bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="text-white font-medium">{{ resource.name }}</h4>
                                        <p class="text-gray-400 text-sm">{{ resource.type }} • {{ resource.size }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-xs text-gray-400 mb-3">
                                <p>Uploaded by: {{ resource.uploadedBy }}</p>
                                <p>Date: {{ resource.uploadDate }}</p>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button @click="downloadResource(resource)" 
                                        class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">
                                    Download
                                </button>
                                <button @click="previewResource(resource)" 
                                        class="px-3 py-2 bg-gray-600 text-white text-sm rounded hover:bg-gray-500 transition-colors">
                                    Preview
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- No Resources Message -->
                    <div v-else class="text-center py-12">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3 class="text-lg font-medium text-white mb-2">No Resources Found</h3>
                        <p class="text-gray-400">No resources match your search criteria.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Flash Cards Modal -->
        <div v-if="showFlashcards" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Flash Cards</h3>
                    <button @click="showFlashcards = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div v-if="flashcards.length > 0" class="space-y-6">
                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300" 
                             :style="{ width: ((currentCardIndex + 1) / flashcards.length) * 100 + '%' }"></div>
                    </div>
                    
                    <!-- Card Counter and Study Mode -->
                    <div class="flex justify-between items-center">
                        <div class="text-gray-400 text-sm">
                        Card {{ currentCardIndex + 1 }} of {{ flashcards.length }}
                        </div>
                        <div class="flex space-x-2">
                            <button @click="toggleStudyMode" 
                                    class="px-3 py-1 text-xs bg-purple-600 text-white rounded-full hover:bg-purple-700">
                                {{ studyMode === 'review' ? 'Review Mode' : 'Test Mode' }}
                            </button>
                            <button @click="shuffleCards" 
                                    class="px-3 py-1 text-xs bg-gray-600 text-white rounded-full hover:bg-gray-500">
                                🔀 Shuffle
                            </button>
                        </div>
                    </div>
                    
                    <!-- Interactive Flash Card -->
                    <div class="relative">
                        <div class="flashcard-container" :class="{ 'flipped': isFlipped }" @click="flipCard">
                            <div class="flashcard-inner">
                                <!-- Front of Card -->
                                <div class="flashcard-front">
                                    <div class="text-center">
                                        <div class="flex justify-between items-center mb-4">
                                            <span class="text-sm text-blue-400 font-medium">Question</span>
                                            <div class="flex space-x-1">
                                                <span v-for="i in 3" :key="i" 
                                                      class="w-2 h-2 rounded-full"
                                                      :class="i <= (flashcards[currentCardIndex].difficulty || 1) ? 'bg-yellow-400' : 'bg-gray-600'"></span>
                        </div>
                        </div>
                                        
                                        <!-- Question Image -->
                                        <div v-if="flashcards[currentCardIndex].questionImage" class="mb-4">
                                            <img :src="flashcards[currentCardIndex].questionImage" 
                                                 :alt="flashcards[currentCardIndex].question"
                                                 class="max-w-full max-h-48 mx-auto rounded-lg shadow-lg">
                    </div>
                    
                                        <h4 class="text-xl font-medium text-white mb-4">{{ flashcards[currentCardIndex].question }}</h4>
                                        
                                        <!-- Question Type Indicator -->
                                        <div v-if="flashcards[currentCardIndex].type" 
                                             class="inline-block px-3 py-1 bg-blue-600 text-white text-sm rounded-full">
                                            {{ flashcards[currentCardIndex].type }}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Back of Card -->
                                <div class="flashcard-back">
                                    <div class="text-center">
                                        <div class="flex justify-between items-center mb-4">
                                            <span class="text-sm text-green-400 font-medium">Answer</span>
                                            <div class="flex space-x-1">
                                                <span v-for="i in 3" :key="i" 
                                                      class="w-2 h-2 rounded-full"
                                                      :class="i <= (flashcards[currentCardIndex].difficulty || 1) ? 'bg-yellow-400' : 'bg-gray-600'"></span>
                                            </div>
                                        </div>
                                        
                                        <!-- Answer Image -->
                                        <div v-if="flashcards[currentCardIndex].answerImage" class="mb-4">
                                            <img :src="flashcards[currentCardIndex].answerImage" 
                                                 :alt="flashcards[currentCardIndex].answer"
                                                 class="max-w-full max-h-48 mx-auto rounded-lg shadow-lg">
                                        </div>
                                        
                                        <h4 class="text-xl font-medium text-white mb-4">{{ flashcards[currentCardIndex].answer }}</h4>
                                        
                                        <!-- Additional Info -->
                                        <div v-if="flashcards[currentCardIndex].explanation" 
                                             class="text-gray-300 text-sm mt-4 p-3 bg-gray-800 rounded-lg">
                                            <strong>Explanation:</strong> {{ flashcards[currentCardIndex].explanation }}
                                        </div>
                                        
                                        <!-- Related Terms -->
                                        <div v-if="flashcards[currentCardIndex].relatedTerms" 
                                             class="text-gray-300 text-sm mt-4">
                                            <strong>Related:</strong> {{ flashcards[currentCardIndex].relatedTerms }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Flip Hint -->
                        <div class="text-center mt-4 text-gray-500 text-sm">
                            <span v-if="!isFlipped">Click to reveal answer</span>
                            <span v-else>Click to see question</span>
                        </div>
                    </div>
                    
                    <!-- Enhanced Card Controls -->
                    <div class="flex justify-between items-center">
                        <button @click="previousCard" :disabled="currentCardIndex === 0" 
                                class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            <span>Previous</span>
                        </button>
                        
                        <div class="flex space-x-2">
                            <!-- Difficulty Rating (only in test mode) -->
                            <div v-if="studyMode === 'test' && isFlipped" class="flex space-x-1">
                                <button v-for="rating in 3" :key="rating" 
                                        @click="rateCard(rating)"
                                        class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-colors"
                                        :class="flashcards[currentCardIndex].userRating === rating ? 'bg-yellow-500 text-black' : 'bg-gray-600 text-white hover:bg-gray-500'">
                                    {{ rating }}
                                </button>
                            </div>
                            
                            <!-- Flip Button -->
                        <button @click="flipCard" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                <span>{{ isFlipped ? 'Show Question' : 'Show Answer' }}</span>
                        </button>
                        </div>
                        
                        <button @click="nextCard" :disabled="currentCardIndex === flashcards.length - 1" 
                                class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
                            <span>Next</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Study Stats -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-blue-400">{{ studyStats.correct }}</div>
                                <div class="text-sm text-gray-400">Correct</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-red-400">{{ studyStats.incorrect }}</div>
                                <div class="text-sm text-gray-400">Incorrect</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-400">{{ studyStats.accuracy }}%</div>
                                <div class="text-sm text-gray-400">Accuracy</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- No Cards Message -->
                <div v-else class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-white mb-2">No Flash Cards Available</h3>
                    <p class="text-gray-400 mb-4">Create your first flash card set to start studying!</p>
                    <button @click="showCreateFlashcard = true" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Create Flash Cards
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Test Page Modal -->
        <div v-if="showTestPage" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Take Test</h3>
                    <button @click="showTestPage = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div v-if="currentTest" class="space-y-6">
                    <!-- Test Header -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h4 class="text-xl font-medium text-white">{{ currentTest.title }}</h4>
                        <p class="text-gray-400">Subject: {{ currentTest.subject }} | Difficulty: {{ currentTest.difficulty }}</p>
                        <p class="text-gray-400">Time Left: {{ formatTime(testTimeLeft) }}</p>
                    </div>
                    
                    <!-- Test Questions -->
                    <div v-for="(question, index) in currentTest.questions" :key="question.id" class="bg-gray-700 p-4 rounded-lg">
                        <h5 class="text-lg font-medium text-white mb-3">Question {{ index + 1 }}</h5>
                        <p class="text-gray-300 mb-4">{{ question.question }}</p>
                        
                        <div class="space-y-2">
                            <label v-for="(option, optionIndex) in question.options" :key="optionIndex" 
                                   class="flex items-center space-x-3 cursor-pointer">
                                <input type="radio" :name="'question_' + question.id" :value="option" 
                                       v-model="testAnswers[question.id]" 
                                       class="w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 focus:ring-blue-500">
                                <span class="text-gray-300">{{ option }}</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button @click="submitTest" 
                                class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            Submit Test
                        </button>
                    </div>
                </div>
                
                <!-- No Test Message -->
                <div v-else class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-white mb-2">No Test Available</h3>
                    <p class="text-gray-400">Enter a test code to start taking a test.</p>
                </div>
            </div>
        </div>
        
        <!-- Result Page Modal -->
        <div v-if="showResultPage" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">Test Results</h3>
                    <button @click="showResultPage = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div v-if="testResults.length > 0" class="space-y-4">
                    <div v-for="result in testResults" :key="result.id" class="bg-gray-700 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-medium text-white">{{ result.testTitle }}</h4>
                            <span class="text-sm text-gray-400">{{ result.date }}</span>
                        </div>
                        <p class="text-gray-400 mb-2">Subject: {{ result.subject }}</p>
                        <div class="flex items-center space-x-4">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-400">{{ result.score }}%</p>
                                <p class="text-sm text-gray-400">Score</p>
                            </div>
                            <div class="text-center">
                                <p class="text-lg font-medium text-white">{{ result.correctAnswers }}/{{ result.totalQuestions }}</p>
                                <p class="text-sm text-gray-400">Correct</p>
                            </div>
                            <div class="text-center">
                                <p class="text-lg font-medium text-white">{{ result.timeTaken }}</p>
                                <p class="text-sm text-gray-400">Time</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- No Results Message -->
                <div v-else class="text-center py-12">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-white mb-2">No Test Results</h3>
                    <p class="text-gray-400">Complete some tests to see your results here.</p>
                </div>
            </div>
        </div>
        
        <!-- AI Chatbot Modal -->
        <div v-if="showChatbot" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 p-6 rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-white">AI Study Assistant</h3>
                    <button @click="showChatbot = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Chat Messages -->
                <div class="bg-gray-700 rounded-lg p-4 h-96 overflow-y-auto mb-4">
                    <div v-for="message in chatMessages" :key="message.id" 
                         :class="message.sender === 'user' ? 'text-right mb-4' : 'text-left mb-4'">
                        <div :class="message.sender === 'user' ? 'bg-blue-600 text-white p-3 rounded-lg inline-block' : 'bg-gray-600 text-white p-3 rounded-lg inline-block'">
                            <p>{{ message.text }}</p>
                            <p class="text-xs opacity-75 mt-1">{{ message.time }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="flex space-x-2">
                    <input v-model="chatInput" type="text" placeholder="Ask me anything about your studies..." 
                           @keyup.enter="sendMessage"
                           class="flex-1 px-4 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-blue-500">
                    <button @click="sendMessage" :disabled="!chatInput.trim()" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        Send
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Create Flashcard Modal -->
        <div v-if="showCreateFlashcard" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-white">Create New Flashcard</h3>
                    <button @click="showCreateFlashcard = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form @submit.prevent="createFlashcard" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Question -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Question</label>
                            <textarea v-model="newFlashcard.question" required
                                      class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500"
                                      rows="3" placeholder="Enter the question..."></textarea>
                        </div>
                        
                        <!-- Answer -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Answer</label>
                            <textarea v-model="newFlashcard.answer" required
                                      class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500"
                                      rows="3" placeholder="Enter the answer..."></textarea>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                            <select v-model="newFlashcard.type"
                                    class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500">
                                <option value="">Select type...</option>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Biology">Biology</option>
                                <option value="History">History</option>
                                <option value="Literature">Literature</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <!-- Difficulty -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty</label>
                            <select v-model="newFlashcard.difficulty"
                                    class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500">
                                <option value="1">Easy</option>
                                <option value="2">Medium</option>
                                <option value="3">Hard</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Explanation -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Explanation (Optional)</label>
                        <textarea v-model="newFlashcard.explanation"
                                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500"
                                  rows="2" placeholder="Add additional explanation..."></textarea>
                    </div>
                    
                    <!-- Related Terms -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Related Terms (Optional)</label>
                        <input v-model="newFlashcard.relatedTerms" type="text"
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500"
                               placeholder="Enter related terms separated by commas...">
                    </div>
                    
                    <!-- Image Upload -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Question Image (Optional)</label>
                            <input @change="handleImageUpload($event, 'question')" type="file" accept="image/*"
                                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Answer Image (Optional)</label>
                            <input @change="handleImageUpload($event, 'answer')" type="file" accept="image/*"
                                   class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Preview Images -->
                    <div v-if="newFlashcard.questionImage || newFlashcard.answerImage" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div v-if="newFlashcard.questionImage">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Question Image Preview</label>
                            <img :src="newFlashcard.questionImage" alt="Question preview" class="w-full h-32 object-cover rounded-lg">
                        </div>
                        <div v-if="newFlashcard.answerImage">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Answer Image Preview</label>
                            <img :src="newFlashcard.answerImage" alt="Answer preview" class="w-full h-32 object-cover rounded-lg">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" @click="showCreateFlashcard = false"
                                class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500">
                            Cancel
                        </button>
                        <button type="submit" :disabled="isLoading"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
                            <div v-if="isLoading" class="loading-spinner"></div>
                            <span>{{ isLoading ? 'Creating...' : 'Create Flashcard' }}</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        
        <!-- Class Management Modal -->
        <div v-if="showClassManagement" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">Class Management</h3>
                    <button @click="showClassManagement = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Create New Class -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Create New Class</h4>
                        <form @submit.prevent="createClass">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Class Name</label>
                                    <input v-model="newClass.name" type="text" required
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Subject</label>
                                    <input v-model="newClass.subject" type="text" required
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Grade Level</label>
                                    <select v-model="newClass.grade" required
                                            class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <option value="">Select Grade</option>
                                        <option value="K">Kindergarten</option>
                                        <option value="1">1st Grade</option>
                                        <option value="2">2nd Grade</option>
                                        <option value="3">3rd Grade</option>
                                        <option value="4">4th Grade</option>
                                        <option value="5">5th Grade</option>
                                        <option value="6">6th Grade</option>
                                        <option value="7">7th Grade</option>
                                        <option value="8">8th Grade</option>
                                        <option value="9">9th Grade</option>
                                        <option value="10">10th Grade</option>
                                        <option value="11">11th Grade</option>
                                        <option value="12">12th Grade</option>
                                        <option value="College">College</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                    <textarea v-model="newClass.description" rows="3"
                                              class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">
                                    Create Class
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Existing Classes -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Your Classes</h4>
                        <div v-if="classes.length === 0" class="text-center py-8">
                            <p class="text-gray-400">No classes created yet</p>
                        </div>
                        <div v-else class="space-y-3">
                            <div v-for="classItem in classes" :key="classItem.id" 
                                 class="bg-gray-600 p-4 rounded-lg hover:bg-gray-500 transition-colors">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="font-semibold text-white">{{ classItem.name }}</h5>
                                        <p class="text-sm text-gray-300">{{ classItem.subject }} - Grade {{ classItem.grade }}</p>
                                        <p class="text-xs text-gray-400">{{ classItem.students.length }} students</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button @click="editClass(classItem)" class="text-blue-400 hover:text-blue-300">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </button>
                                        <button @click="deleteClass(classItem.id)" class="text-red-400 hover:text-red-300">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Assignment System Modal -->
        <div v-if="showAssignmentSystem" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">Assignment System</h3>
                    <button @click="showAssignmentSystem = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Create Assignment -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Create Assignment</h4>
                        <form @submit.prevent="createAssignment">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Assignment Title</label>
                                    <input v-model="newAssignment.title" type="text" required
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Select Class</label>
                                    <select v-model="newAssignment.classId" required
                                            class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">Select Class</option>
                                        <option v-for="classItem in classes" :key="classItem.id" :value="classItem.id">
                                            {{ classItem.name }} - {{ classItem.subject }}
                                        </option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Select Flashcards</label>
                                    <div class="max-h-40 overflow-y-auto border border-gray-500 rounded-md p-2">
                                        <div v-for="flashcard in flashcards" :key="flashcard.id" class="flex items-center space-x-2 mb-2">
                                            <input :id="'flashcard-' + flashcard.id" type="checkbox" 
                                                   :value="flashcard.id" v-model="newAssignment.flashcardIds"
                                                   class="rounded border-gray-500">
                                            <label :for="'flashcard-' + flashcard.id" class="text-sm text-gray-300">
                                                {{ flashcard.question.substring(0, 50) }}...
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Due Date</label>
                                    <input v-model="newAssignment.dueDate" type="datetime-local" required
                                           class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Instructions</label>
                                    <textarea v-model="newAssignment.instructions" rows="3"
                                              class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700">
                                    Create Assignment
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Existing Assignments -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Assignments</h4>
                        <div v-if="assignments.length === 0" class="text-center py-8">
                            <p class="text-gray-400">No assignments created yet</p>
                        </div>
                        <div v-else class="space-y-3">
                            <div v-for="assignment in assignments" :key="assignment.id" 
                                 class="bg-gray-600 p-4 rounded-lg">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h5 class="font-semibold text-white">{{ assignment.title }}</h5>
                                        <p class="text-sm text-gray-300">{{ getClassById(assignment.classId)?.name }}</p>
                                        <p class="text-xs text-gray-400">{{ assignment.flashcardIds.length }} flashcards</p>
                                        <p class="text-xs text-gray-400">Due: {{ formatDate(assignment.dueDate) }}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button @click="viewAssignment(assignment)" class="text-blue-400 hover:text-blue-300">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                            </svg>
                                        </button>
                                        <button @click="deleteAssignment(assignment.id)" class="text-red-400 hover:text-red-300">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Monitoring Modal -->
        <div v-if="showProgressMonitoring" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">Progress Monitoring</h3>
                    <button @click="showProgressMonitoring = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Class Selection -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Select Class</h4>
                        <div class="space-y-3">
                            <div v-for="classItem in classes" :key="classItem.id" 
                                 @click="selectedClass = classItem"
                                 :class="['p-3 rounded-lg cursor-pointer transition-colors', 
                                         selectedClass?.id === classItem.id ? 'bg-orange-600' : 'bg-gray-600 hover:bg-gray-500']">
                                <h5 class="font-semibold text-white">{{ classItem.name }}</h5>
                                <p class="text-sm text-gray-300">{{ classItem.students.length }} students</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Progress -->
                    <div class="lg:col-span-2 bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Student Progress</h4>
                        <div v-if="!selectedClass" class="text-center py-8">
                            <p class="text-gray-400">Select a class to view progress</p>
                        </div>
                        <div v-else class="space-y-4">
                            <div v-for="student in selectedClass.students" :key="student.id" 
                                 class="bg-gray-600 p-4 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h5 class="font-semibold text-white">{{ student.name }}</h5>
                                        <p class="text-sm text-gray-300">{{ student.email }}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm text-gray-300">
                                            Progress: {{ getStudentProgress(student.id) }}%
                                        </div>
                                        <div class="w-32 bg-gray-500 rounded-full h-2 mt-1">
                                            <div class="bg-orange-500 h-2 rounded-full" 
                                                 :style="{ width: getStudentProgress(student.id) + '%' }"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bulk Operations Modal -->
        <div v-if="showBulkOperations" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">Bulk Operations</h3>
                    <button @click="showBulkOperations = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Student Selection -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Select Students</h4>
                        <div class="space-y-3 max-h-60 overflow-y-auto">
                            <div v-for="classItem in classes" :key="classItem.id">
                                <h5 class="text-sm font-medium text-gray-300 mb-2">{{ classItem.name }}</h5>
                                <div v-for="student in classItem.students" :key="student.id" 
                                     class="flex items-center space-x-2 ml-4 mb-1">
                                    <input :id="'student-' + student.id" type="checkbox" 
                                           :value="student.id" v-model="selectedStudents"
                                           class="rounded border-gray-500">
                                    <label :for="'student-' + student.id" class="text-sm text-gray-300">
                                        {{ student.name }}
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button @click="selectAllStudents" class="text-blue-400 hover:text-blue-300 text-sm">
                                Select All
                            </button>
                            <button @click="clearSelection" class="text-red-400 hover:text-red-300 text-sm ml-4">
                                Clear Selection
                            </button>
                        </div>
                    </div>
                    
                    <!-- Bulk Actions -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Bulk Actions</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Assign Flashcards</label>
                                <select class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white">
                                    <option value="">Select Assignment</option>
                                    <option v-for="assignment in assignments" :key="assignment.id" :value="assignment.id">
                                        {{ assignment.title }}
                                    </option>
                                </select>
                                <button class="mt-2 w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">
                                    Assign to Selected Students
                                </button>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Send Message</label>
                                <textarea rows="3" placeholder="Type your message..."
                                          class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white"></textarea>
                                <button class="mt-2 w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
                                    Send to Selected Students
                                </button>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Export Data</label>
                                <button class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">
                                    Export Selected Students Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Report Generation Modal -->
        <div v-if="showReportGeneration" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">Report Generation</h3>
                    <button @click="showReportGeneration = false" class="text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Report Configuration -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Report Configuration</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Report Type</label>
                                <select class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white">
                                    <option value="progress">Student Progress Report</option>
                                    <option value="assignment">Assignment Performance</option>
                                    <option value="class">Class Overview</option>
                                    <option value="flashcard">Flashcard Usage</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Select Class</label>
                                <select class="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white">
                                    <option value="">All Classes</option>
                                    <option v-for="classItem in classes" :key="classItem.id" :value="classItem.id">
                                        {{ classItem.name }}
                                    </option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date Range</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="date" class="px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white">
                                    <input type="date" class="px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-white">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Include Charts</label>
                                <div class="flex space-x-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="rounded border-gray-500">
                                        <span class="ml-2 text-sm text-gray-300">Progress Charts</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="rounded border-gray-500">
                                        <span class="ml-2 text-sm text-gray-300">Performance Graphs</span>
                                    </label>
                                </div>
                            </div>
                            
                            <button class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">
                                Generate Report
                            </button>
                        </div>
                    </div>
                    
                    <!-- Report Preview -->
                    <div class="bg-gray-700 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-white mb-4">Report Preview</h4>
                        <div class="text-center py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <p class="text-gray-400">Configure and generate a report to see preview</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    user: null,
                    showProfile: false,
                    showProfileSettings: false,
                    showAccountSettings: false,
                    profileForm: {
                        firstName: '',
                        lastName: '',
                        email: '',
                        role: ''
                    },
                    passwordForm: {
                        currentPassword: '',
                        newPassword: '',
                        confirmPassword: ''
                    },
                    // Module Modals
                    showAITestMaker: false,
                    showPerformanceAnalysis: false,
                    showStudentManagement: false,
                    showCoursePlanner: false,
                    showResourceUpload: false,
                    showCustomQuestionCreator: false,
                    showFlashcards: false,
                    showTestPage: false,
                    showResultPage: false,
                    showResources: false,
                    showChatbot: false,
                    // AI Test Maker Data
                    testConfig: {
                        subject: '',
                        difficulty: 'Medium',
                        count: 5,
                        timeLimit: 60
                    },
                    generatedQuestions: [],
                    isGeneratingQuestions: false,
                    testError: '',
                    testCode: '',
                    publishedTests: [],
                    showTestCode: false,
                    // Performance Analysis Data
                    performanceData: {
                        students: [],
                        averageScore: 0,
                        totalTests: 0,
                        improvementRate: 0
                    },
                    // Student Management Data
                    students: [],
                    selectedStudent: null,
                    newStudent: {
                        firstName: '',
                        lastName: '',
                        email: ''
                    },
                    studentUpdateInterval: null,
                    testUpdateInterval: null,
                    newStudentNotification: null,
                    // User Stats Data
                    userStats: {
                        coursesCompleted: 0,
                        currentStreak: 0,
                        learningPoints: 0
                    },
                    // Custom Question Creator Data
                    customTestConfig: {
                        title: '',
                        subject: '',
                        difficulty: 'Medium',
                        timeLimit: 60
                    },
                    customQuestions: [],
                    newQuestion: {
                        question: '',
                        options: ['', '', '', ''],
                        correctAnswer: ''
                    },
                    // Course Planner Data
                    coursePlan: {
                        title: '',
                        description: '',
                        startDate: '',
                        endDate: '',
                        topics: []
                    },
                    // Resource Upload Data
                    uploadedFiles: [],
                    uploadProgress: 0,
                    isDragOver: false,
                    isUploading: false,
                    // Flashcards Data
                    flashcardSets: [],
                    currentSet: null,
                    currentCard: 0,
                    // Test Page Data
                    currentTest: null,
                    testAnswers: {},
                    testTimeRemaining: 0,
                    // Result Page Data
                    testResults: [],
                    // Resources Data
                    resources: [],
                    // Chatbot Data
                    chatMessages: [],
                    chatInput: '',
                    isChatting: false,
                    // Test Taking Data
                    testCodeInput: '',
                    availableTests: [],
                    // Resources Data
                    resourceSearch: '',
                    resourceFilter: '',
                    // Courses Data
                    courses: [],
                    // Student Module Data
                    showFlashcards: false,
                    showTestPage: false,
                    showResultPage: false,
                    showChatbot: false,
                    // Flash Cards Data
                    flashcards: [],
                    currentCardIndex: 0,
                    isFlipped: false,
                    studyMode: 'review', // 'review' or 'test'
                    studyStats: {
                        correct: 0,
                        incorrect: 0,
                        accuracy: 0
                    },
                    // Flashcard Creation
                    showCreateFlashcard: false,
                    newFlashcard: {
                        question: '',
                        answer: '',
                        type: '',
                        difficulty: 1,
                        explanation: '',
                        relatedTerms: '',
                        questionImage: null,
                        answerImage: null
                    },
                    isLoading: false,
                    audioContext: null,
                    
                    // Educator Tools
                    classes: [],
                    assignments: [],
                    studentProgress: {},
                    showClassManagement: false,
                    showAssignmentSystem: false,
                    showProgressMonitoring: false,
                    showBulkOperations: false,
                    showReportGeneration: false,
                    selectedClass: null,
                    selectedStudents: [],
                    newClass: {
                        name: '',
                        description: '',
                        subject: '',
                        grade: '',
                        students: []
                    },
                    newAssignment: {
                        title: '',
                        description: '',
                        classId: '',
                        flashcardIds: [],
                        dueDate: '',
                        instructions: ''
                    },
                    // Test Taking Data
                    currentTest: null,
                    testAnswers: {},
                    testTimeLeft: 0,
                    testTimer: null,
                    // Results Data
                    testResults: [],
                    // Chatbot Data
                    chatMessages: [],
                    learningProgressData: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Progress %',
                            data: [20, 40, 60, 80],
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: '#3B82F6',
                            fill: true,
                        }]
                    },
                    subjectDistributionData: {
                        labels: ['Mathematics', 'Science', 'Language', 'History'],
                        datasets: [{
                            label: 'Subject Distribution',
                            data: [35, 25, 20, 20],
                            backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
                        }]
                    }
                }
            },
            computed: {
                userName() {
                    if (this.user) {
                        if (this.user.name) {
                            return this.user.name;
                        } else if (this.user.firstName && this.user.lastName) {
                            return `${this.user.firstName} ${this.user.lastName}`;
                        } else if (this.user.firstName) {
                            return this.user.firstName;
                        } else if (this.user.email) {
                            return this.user.email.split('@')[0];
                        }
                    }
                    return 'User';
                },
                userInitials() {
                    const name = this.userName;
                    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                }
            },
            mounted() {
                // Initialize navigation system
                this.initializeNavigation();
                
                const userData = localStorage.getItem('user');
                console.log('User data from localStorage:', userData);
                
                if (userData) {
                    try {
                        this.user = JSON.parse(userData);
                        console.log('Parsed user data:', this.user);
                        this.profileForm = {
                            firstName: this.user.firstName || '',
                            lastName: this.user.lastName || '',
                            email: this.user.email || '',
                            role: this.user.role || ''
                        };
                        console.log('User name computed:', this.userName);
                    } catch (error) {
                        console.error('Error parsing user data:', error);
                    }
                } else {
                    console.log('No user data found, redirecting to login');
                    // Redirect to login if no user data
                    setTimeout(() => {
                        window.location.href = 'login-simple.html';
                    }, 1000);
                    return;
                }
                
                this.initCharts();
                this.initializeSampleData();
                this.loadResourcesFromDatabase();
                this.loadStudentsFromDatabase();
                
                // Force reactivity update
                this.$nextTick(() => {
                    console.log('User name after nextTick:', this.userName);
                });
                this.loadTestsFromDatabase();
                this.loadCoursesFromDatabase();
                this.syncAvailableTests();
                this.loadUserStats();
                this.updateDailyStreak();
                
                // Set up real-time updates for students (every 30 seconds)
                if (this.user.role === 'educator') {
                    this.studentUpdateInterval = setInterval(() => {
                        this.loadStudentsFromDatabase();
                    }, 30000); // Update every 30 seconds
                }
                
                // Set up real-time updates for tests (every 60 seconds)
                this.testUpdateInterval = setInterval(() => {
                    this.loadTestsFromDatabase();
                }, 60000); // Update every 60 seconds
                
                
                // Add keyboard event listener
                document.addEventListener('keydown', this.handleKeydown);
                
                // Initialize audio context on user interaction
                document.addEventListener('click', () => {
                    if (!this.audioContext) {
                        try {
                            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        } catch (error) {
                            console.log('Audio not supported');
                        }
                    }
                }, { once: true });
                
                // Add global methods for debugging
                window.clearAllFilesNow = () => {
                    this.forceClearAllFiles();
                };
                
                window.removeTulasiFile = () => {
                    this.removeSpecificFile('TULASI SHETTY RESUME.pdf');
                };
                
                // Nuclear option - completely disable file loading
                window.nuclearClear = () => {
                    this.uploadedFiles = [];
                    this.resources = [];
                    localStorage.clear();
                    sessionStorage.clear();
                    alert('NUCLEAR CLEAR: Everything cleared. Page will reload.');
                    window.location.reload();
                };
                
            },
            beforeUnmount() {
                // Clean up the intervals when component is destroyed
                if (this.studentUpdateInterval) {
                    clearInterval(this.studentUpdateInterval);
                }
                if (this.testUpdateInterval) {
                    clearInterval(this.testUpdateInterval);
                }
                
                // Clean up event listeners
                document.removeEventListener('keydown', this.handleKeydown);
            },
            computed: {
                filteredResources() {
                    let filtered = this.resources;
                    
                    // Filter by search term
                    if (this.resourceSearch.trim()) {
                        const searchTerm = this.resourceSearch.toLowerCase();
                        filtered = filtered.filter(resource => 
                            resource.name.toLowerCase().includes(searchTerm) ||
                            resource.uploadedBy.toLowerCase().includes(searchTerm)
                        );
                    }
                    
                    // Filter by type
                    if (this.resourceFilter) {
                        filtered = filtered.filter(resource => resource.type === this.resourceFilter);
                    }
                    
                    return filtered;
                }
            },
            methods: {
                initializeNavigation() {
                    // Initialize navigation system
                    if (window.navigation) {
                        const navContainer = document.getElementById('navigation-container');
                        if (navContainer) {
                            navContainer.innerHTML = window.navigation.generateNavigationHTML();
                            window.navigation.initialize();
                        }
                    }
                },
                
                initCharts() {
                    try {
                        // Learning Progress Chart
                        const progressCtx = document.getElementById('learningProgressChart').getContext('2d');
                        new Chart(progressCtx, {
                            type: 'line',
                            data: this.learningProgressData,
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            color: 'rgba(255, 255, 255, 0.1)'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#E5E7EB'
                                        }
                                    }
                                }
                            }
                        });

                        // Subject Distribution Chart
                        const subjectCtx = document.getElementById('subjectDistributionChart').getContext('2d');
                        new Chart(subjectCtx, {
                            type: 'doughnut',
                            data: this.subjectDistributionData,
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            color: '#E5E7EB'
                                        }
                                    }
                                }
                            }
                        });
                    } catch (error) {
                        console.error('Error initializing charts:', error);
                    }
                },
                openModule(moduleName) {
                    switch(moduleName) {
                        case 'ai-test-maker':
                            this.showAITestMaker = true;
                            break;
                        case 'performance-analysis':
                            this.showPerformanceAnalysis = true;
                            break;
                        case 'student-management':
                            this.showStudentManagement = true;
                            break;
                        case 'course-planner':
                            this.showCoursePlanner = true;
                            break;
                        case 'resource-upload':
                            this.showResourceUpload = true;
                            this.loadUploadedFiles();
                            break;
                        case 'custom-question-creator':
                            this.showCustomQuestionCreator = true;
                            break;
                        case 'flashcards':
                            this.showFlashcards = true;
                            break;
                        case 'test-page':
                            this.showTestPage = true;
                            break;
                        case 'result-page':
                            this.showResultPage = true;
                            break;
                        case 'resources':
                            this.showResources = true;
                            break;
                        case 'chatbot':
                            this.showChatbot = true;
                            break;
                        default:
                            alert('Module not found!');
                    }
                },
                handleLogout() {
                    localStorage.removeItem('user');
                    window.location.href = 'login-simple.html';
                },
                async updateProfile() {
                    // Update profile in database
                    try {
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/simple_users?id=eq.' + this.user.id, {
                            method: 'PATCH',
                            headers: {
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                first_name: this.profileForm.firstName,
                                last_name: this.profileForm.lastName,
                                email: this.profileForm.email
                            })
                        });

                        if (response.ok) {
                            // Update localStorage
                            this.user.firstName = this.profileForm.firstName;
                            this.user.lastName = this.profileForm.lastName;
                            this.user.name = `${this.profileForm.firstName} ${this.profileForm.lastName}`;
                            this.user.email = this.profileForm.email;
                            localStorage.setItem('user', JSON.stringify(this.user));
                            
                            alert('Profile updated successfully!');
                            this.showProfileSettings = false;
                        } else {
                            alert('Failed to update profile. Please try again.');
                        }
                    } catch (error) {
                        alert('Failed to update profile. Please try again.');
                        console.error('Error updating profile:', error);
                    }
                },
                deleteAccount() {
                    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                        alert('Account deletion functionality would be implemented here!');
                    }
                },
                // AI Test Maker Methods
                async generateTestQuestions() {
                    if (!this.testConfig.subject.trim()) {
                        this.testError = 'Please enter a subject for the test.';
                        return;
                    }
                    
                    this.isGeneratingQuestions = true;
                    this.testError = '';
                    
                    try {
                        // Simulate AI question generation
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        const sampleQuestions = this.generateSampleQuestions(
                            this.testConfig.subject,
                            this.testConfig.difficulty,
                            parseInt(this.testConfig.count)
                        );
                        
                        this.generatedQuestions = sampleQuestions;
                    } catch (error) {
                        this.testError = 'Failed to generate questions. Please try again.';
                        console.error('Error generating questions:', error);
                    } finally {
                        this.isGeneratingQuestions = false;
                    }
                },
                
                generateSampleQuestions(subject, difficulty, count) {
                    const questions = [];
                    const difficulties = {
                        'Easy': { complexity: 'basic', time: '2-3 minutes' },
                        'Medium': { complexity: 'intermediate', time: '3-5 minutes' },
                        'Hard': { complexity: 'advanced', time: '5-7 minutes' }
                    };
                    
                    // Engineering-specific question templates
                    const engineeringQuestions = {
                        'Engineering Mechanics': [
                            'What is Newton\'s second law of motion?',
                            'Calculate the moment of force about point A.',
                            'What is the principle of virtual work?',
                            'Determine the reaction forces at the supports.',
                            'What is the difference between static and dynamic equilibrium?'
                        ],
                        'Thermodynamics': [
                            'What is the first law of thermodynamics?',
                            'Calculate the efficiency of a Carnot cycle.',
                            'What is the difference between heat and work?',
                            'Determine the change in entropy for the process.',
                            'What is the concept of enthalpy?'
                        ],
                        'Circuit Analysis': [
                            'Apply Kirchhoff\'s voltage law to the circuit.',
                            'Calculate the equivalent resistance.',
                            'What is the time constant of the RC circuit?',
                            'Determine the power dissipated in the resistor.',
                            'What is the concept of impedance?'
                        ],
                        'Machine Design': [
                            'Calculate the factor of safety for the component.',
                            'What is the endurance limit of the material?',
                            'Determine the required shaft diameter.',
                            'Calculate the bearing life in hours.',
                            'What is the concept of stress concentration?'
                        ],
                        'Fluid Mechanics': [
                            'Apply Bernoulli\'s equation to the flow.',
                            'Calculate the Reynolds number for the flow.',
                            'What is the pressure drop in the pipe?',
                            'Determine the flow rate through the orifice.',
                            'What is the concept of viscosity?'
                        ],
                        'Materials Science': [
                            'What is the difference between stress and strain?',
                            'Calculate the Young\'s modulus of the material.',
                            'What is the concept of fatigue failure?',
                            'Determine the hardness of the material.',
                            'What is the crystal structure of the material?'
                        ],
                        'Control Systems': [
                            'What is the transfer function of the system?',
                            'Calculate the damping ratio of the system.',
                            'What is the concept of stability?',
                            'Determine the steady-state error.',
                            'What is the concept of feedback control?'
                        ]
                    };
                    
                    // Engineering-specific options for each subject
                    const engineeringOptions = {
                        'Engineering Mechanics': [
                            ['F = ma', 'F = mv', 'F = ma²', 'F = m/a'],
                            ['Force × Distance', 'Mass × Velocity', 'Force × Time', 'Mass × Acceleration'],
                            ['Work done by virtual forces', 'Energy conservation', 'Momentum conservation', 'Force equilibrium'],
                            ['Sum of forces = 0', 'Sum of moments = 0', 'Both A and B', 'Neither A nor B'],
                            ['Static: no motion, Dynamic: motion', 'Static: motion, Dynamic: no motion', 'No difference', 'Static: acceleration, Dynamic: velocity']
                        ],
                        'Thermodynamics': [
                            ['Energy cannot be created or destroyed', 'Heat flows from hot to cold', 'Entropy always increases', 'Work equals heat'],
                            ['1 - (T_cold/T_hot)', 'T_hot/(T_hot - T_cold)', 'T_cold/(T_hot - T_cold)', 'T_hot/T_cold'],
                            ['Heat is energy transfer, Work is force × distance', 'No difference', 'Heat is temperature, Work is energy', 'Heat is internal, Work is external'],
                            ['Q/T', 'Q × T', 'Q + T', 'Q - T'],
                            ['Internal energy + PV', 'Internal energy - PV', 'Internal energy × PV', 'Internal energy / PV']
                        ],
                        'Circuit Analysis': [
                            ['Sum of voltages in loop = 0', 'Sum of currents at node = 0', 'Power = VI', 'Resistance = V/I'],
                            ['R1 + R2 + R3', '1/(1/R1 + 1/R2 + 1/R3)', 'R1 × R2 × R3', 'R1 + R2 - R3'],
                            ['RC', 'R/C', 'R + C', 'R - C'],
                            ['V²/R', 'I²R', 'VI', 'All of the above'],
                            ['Resistance + Reactance', 'Resistance - Reactance', 'Resistance × Reactance', 'Resistance / Reactance']
                        ],
                        'Machine Design': [
                            ['Ultimate stress / Working stress', 'Working stress / Ultimate stress', 'Ultimate stress + Working stress', 'Ultimate stress - Working stress'],
                            ['Maximum stress for infinite life', 'Minimum stress for failure', 'Average stress', 'Stress at yield point'],
                            ['(16T/πτ)^(1/3)', '(32T/πτ)^(1/3)', '(T/πτ)^(1/3)', '(T/2πτ)^(1/3)'],
                            ['(C/P)^(10/3) × 10^6', '(P/C)^(10/3) × 10^6', '(C/P)^(3/10) × 10^6', '(P/C)^(3/10) × 10^6'],
                            ['Stress increase at geometric discontinuities', 'Stress decrease at holes', 'No effect', 'Stress becomes zero']
                        ],
                        'Fluid Mechanics': [
                            ['P + ½ρv² + ρgh = constant', 'P + ρv + ρg = constant', 'P + ρv² + ρg = constant', 'P + ½ρv + ρgh = constant'],
                            ['ρvD/μ', 'μvD/ρ', 'ρD/μv', 'μD/ρv'],
                            ['f(L/D)(ρv²/2)', 'f(L/D)(ρv/2)', 'f(L/D)(ρv²)', 'f(L/D)(ρv)'],
                            ['C_d × A × √(2gh)', 'C_d × A × √(gh)', 'C_d × A × 2gh', 'C_d × A × gh'],
                            ['Resistance to flow', 'Flow rate', 'Pressure', 'Velocity']
                        ],
                        'Materials Science': [
                            ['Force per unit area', 'Deformation per unit length', 'Force per unit length', 'Deformation per unit area'],
                            ['Stress / Strain', 'Strain / Stress', 'Stress × Strain', 'Stress + Strain'],
                            ['Failure under cyclic loading', 'Failure under static loading', 'Failure under impact', 'Failure under compression'],
                            ['Resistance to indentation', 'Resistance to bending', 'Resistance to tension', 'Resistance to shear'],
                            ['BCC, FCC, HCP', 'ABC, DEF, GHI', 'Square, Circle, Triangle', 'Solid, Liquid, Gas']
                        ],
                        'Control Systems': [
                            ['Output / Input', 'Input / Output', 'Output × Input', 'Output - Input'],
                            ['ζ = c/(2√(mk))', 'ζ = c/(2mk)', 'ζ = 2c/(√(mk))', 'ζ = 2c/(mk)'],
                            ['All poles in left half plane', 'All poles in right half plane', 'Poles on imaginary axis', 'No poles'],
                            ['1/(1 + K_p)', 'K_p/(1 + K_p)', '1/K_p', 'K_p'],
                            ['System output fed back to input', 'System input fed to output', 'System gain', 'System delay']
                        ]
                    };
                    
                    for (let i = 1; i <= count; i++) {
                        let questionText;
                        let options;
                        
                        if (engineeringQuestions[subject]) {
                            const templates = engineeringQuestions[subject];
                            const questionIndex = Math.floor(Math.random() * templates.length);
                            questionText = templates[questionIndex];
                            
                            // Get corresponding options
                            if (engineeringOptions[subject] && engineeringOptions[subject][questionIndex]) {
                                options = engineeringOptions[subject][questionIndex];
                            } else {
                                // Fallback options
                                options = [
                                    'A) Correct answer',
                                    'B) Incorrect option 1',
                                    'C) Incorrect option 2',
                                    'D) Incorrect option 3'
                                ];
                            }
                        } else {
                            questionText = `What is the ${difficulties[difficulty].complexity} concept of ${subject} in question ${i}?`;
                            options = [
                                'A) Correct answer',
                                'B) Incorrect option 1',
                                'C) Incorrect option 2',
                                'D) Incorrect option 3'
                            ];
                        }
                        
                        // Randomly select correct answer
                        const correctIndex = Math.floor(Math.random() * options.length);
                        const correctAnswer = options[correctIndex];
                        
                        questions.push({
                            id: i,
                            question: questionText,
                            options: options,
                            correctAnswer: correctAnswer,
                            difficulty: difficulty,
                            timeLimit: difficulties[difficulty].time
                        });
                    }
                    
                    return questions;
                },
                
                async saveTest() {
                    if (this.generatedQuestions.length === 0) {
                        alert('No questions to save!');
                        return;
                    }
                    
                    try {
                        const testData = {
                            title: `${this.testConfig.subject} - ${this.testConfig.difficulty} Level`,
                            subject: this.testConfig.subject,
                            difficulty: this.testConfig.difficulty,
                            time_limit: this.testConfig.timeLimit,
                            questions: JSON.stringify(this.generatedQuestions),
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString(),
                            status: 'draft'
                        };
                        
                        // Save to Supabase database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/tests', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(testData)
                        });
                        
                        if (response.ok) {
                            alert('Test saved to database successfully!');
                            this.showAITestMaker = false;
                            this.generatedQuestions = [];
                            this.testConfig.subject = '';
                        } else {
                            throw new Error('Failed to save to database');
                        }
                    } catch (error) {
                        alert('Failed to save test to database. Please try again.');
                        console.error('Error saving test:', error);
                    }
                },
                
                previewTest() {
                    if (this.generatedQuestions.length === 0) {
                        alert('No questions to preview!');
                        return;
                    }
                    
                    alert('Test preview functionality would open in a new window!');
                },
                
                async publishTest() {
                    if (this.generatedQuestions.length === 0) {
                        alert('No questions to publish!');
                        return;
                    }
                    
                    try {
                        // Generate unique test code
                        const testCode = this.generateTestCode();
                        
                        const testData = {
                            title: `${this.testConfig.subject} - ${this.testConfig.difficulty} Level`,
                            subject: this.testConfig.subject,
                            difficulty: this.testConfig.difficulty,
                            time_limit: this.testConfig.timeLimit,
                            questions: JSON.stringify(this.generatedQuestions),
                            test_code: testCode,
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString(),
                            status: 'published'
                        };
                        
                        // Save to Supabase database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/tests', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(testData)
                        });
                        
                        if (response.ok) {
                            // Add to published tests locally
                            const publishedTest = {
                                id: Date.now(),
                                title: testData.title,
                                subject: testData.subject,
                                difficulty: testData.difficulty,
                                timeLimit: testData.time_limit,
                                questions: this.generatedQuestions,
                                code: testCode
                            };
                            this.publishedTests.push(publishedTest);
                            
                            // Show test code
                            this.testCode = testCode;
                            this.showTestCode = true;
                            
                            // Sync with available tests for students
                            this.syncAvailableTests();
                            
                            // Clear form
                            this.generatedQuestions = [];
                            this.testConfig.subject = '';
                            
                            alert('Test published and saved to database successfully! Share the code with your students.');
                        } else {
                            throw new Error('Failed to save to database');
                        }
                        
                    } catch (error) {
                        alert('Failed to publish test to database. Please try again.');
                        console.error('Error publishing test:', error);
                    }
                },
                
                generateTestCode() {
                    // Generate a 6-character alphanumeric code
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                    let result = '';
                    for (let i = 0; i < 6; i++) {
                        result += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    return result;
                },
                
                copyTestCode(code = null) {
                    const codeToCopy = code || this.testCode;
                    navigator.clipboard.writeText(codeToCopy).then(() => {
                        alert('Test code copied to clipboard!');
                    }).catch(() => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = codeToCopy;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('Test code copied to clipboard!');
                    });
                },
                
                viewTestResults(test) {
                    alert(`Test Results for "${test.title}"\n\nCode: ${test.code}\n\nResults functionality would be implemented here!`);
                },
                
                unpublishTest(test) {
                    if (confirm(`Are you sure you want to unpublish "${test.title}"?\n\nStudents will no longer be able to access this test.`)) {
                        const index = this.publishedTests.findIndex(t => t.id === test.id);
                        if (index > -1) {
                            this.publishedTests.splice(index, 1);
                            alert('Test unpublished successfully!');
                        }
                    }
                },
                
                // Student Management Methods
                async addStudent() {
                    if (!this.newStudent.firstName.trim() || !this.newStudent.lastName.trim() || !this.newStudent.email.trim()) {
                        alert('Please fill in all fields!');
                        return;
                    }
                    
                    // Check if email already exists
                    const emailExists = this.students.some(student => student.email.toLowerCase() === this.newStudent.email.toLowerCase());
                    if (emailExists) {
                        alert('A student with this email already exists!');
                        return;
                    }
                    
                    const newStudent = {
                        id: Date.now(),
                        name: `${this.newStudent.firstName.trim()} ${this.newStudent.lastName.trim()}`,
                        email: this.newStudent.email.trim(),
                        progress: Math.floor(Math.random() * 40) + 30, // Random progress between 30-70%
                        lastActive: 'Just now'
                    };
                    
                    try {
                        const studentData = {
                            first_name: this.newStudent.firstName.trim(),
                            last_name: this.newStudent.lastName.trim(),
                            email: this.newStudent.email.trim(),
                            role: 'student',
                            progress: newStudent.progress,
                            last_active: new Date().toISOString(),
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString()
                        };
                        
                        // Try to save to Supabase database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/students', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(studentData)
                        });
                        
                        if (response.ok) {
                            // Database save successful
                            this.students.push(newStudent);
                            this.saveStudentsToLocalStorage();
                            alert('Student added and saved to database successfully!');
                        } else {
                            // Database save failed, save to localStorage as fallback
                            this.students.push(newStudent);
                            this.saveStudentsToLocalStorage();
                            alert('Student added and saved locally (database not available yet). Please create the database tables for full functionality.');
                        }
                    } catch (error) {
                        // Database error, save to localStorage as fallback
                        this.students.push(newStudent);
                        this.saveStudentsToLocalStorage();
                        alert('Student added and saved locally (database not available yet). Please create the database tables for full functionality.');
                        console.error('Error adding student:', error);
                    }
                    
                    // Clear form
                    this.newStudent = {
                        firstName: '',
                        lastName: '',
                        email: ''
                    };
                },
                
                viewStudent(student) {
                    alert(`Student Details:\nName: ${student.name}\nEmail: ${student.email}\nProgress: ${student.progress}%\nLast Active: ${student.lastActive}`);
                },
                
                editStudent(student) {
                    const newName = prompt('Enter new name:', student.name);
                    if (newName && newName.trim()) {
                        student.name = newName.trim();
                        alert('Student name updated successfully!');
                    }
                },
                
                async deleteStudent(student) {
                    if (confirm(`Are you sure you want to remove ${student.name}?\n\nThis action cannot be undone.`)) {
                        try {
                            // Try to delete from Supabase database
                            const response = await fetch(`https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/students?email=eq.${student.email}`, {
                                method: 'DELETE',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                                }
                            });
                            
                            if (response.ok) {
                                // Database delete successful
                                const index = this.students.findIndex(s => s.id === student.id);
                                if (index > -1) {
                                    this.students.splice(index, 1);
                                }
                                this.saveStudentsToLocalStorage();
                                alert('Student removed from database successfully!');
                            } else {
                                // Database delete failed, remove from localStorage
                                const index = this.students.findIndex(s => s.id === student.id);
                                if (index > -1) {
                                    this.students.splice(index, 1);
                                }
                                this.saveStudentsToLocalStorage();
                                alert('Student removed locally (database not available yet).');
                            }
                        } catch (error) {
                            // Database error, remove from localStorage
                            const index = this.students.findIndex(s => s.id === student.id);
                            if (index > -1) {
                                this.students.splice(index, 1);
                            }
                            this.saveStudentsToLocalStorage();
                            alert('Student removed locally (database not available yet).');
                            console.error('Error deleting student:', error);
                        }
                    }
                },
                
                // Test Taking Methods
                joinTest() {
                    if (!this.testCodeInput.trim()) {
                        alert('Please enter a test code!');
                        return;
                    }
                    
                    console.log('Attempting to join test with code:', this.testCodeInput.toUpperCase());
                    console.log('Available tests:', this.availableTests);
                    console.log('Published tests:', this.publishedTests);
                    
                    // Check if test code exists in available tests or published tests
                    let test = this.availableTests.find(t => t.code === this.testCodeInput.toUpperCase());
                    
                    // If not found in availableTests, check publishedTests
                    if (!test) {
                        test = this.publishedTests.find(t => t.code === this.testCodeInput.toUpperCase());
                        console.log('Test found in publishedTests:', test);
                    } else {
                        console.log('Test found in availableTests:', test);
                    }
                    
                    if (test) {
                        // Convert published test format to test format if needed
                        const testData = {
                            id: test.id,
                            title: test.title,
                            subject: test.subject,
                            difficulty: test.difficulty,
                            timeLimit: test.time_limit || test.timeLimit,
                            questions: typeof test.questions === 'string' ? JSON.parse(test.questions) : test.questions,
                            code: test.code || test.test_code
                        };
                        
                        this.currentTest = testData;
                        this.testTimeLeft = testData.timeLimit * 60; // Convert to seconds
                        this.testAnswers = {};
                        this.startTestTimer();
                        this.showTestPage = true;
                        this.testCodeInput = '';
                    } else {
                        alert('Invalid test code! Please check the code and try again.');
                    }
                },
                
                startTest(test) {
                    this.currentTest = test;
                    this.testTimeLeft = test.timeLimit * 60;
                    this.testAnswers = {};
                    this.startTestTimer();
                    this.showTestPage = true;
                },
                
                startTestTimer() {
                    this.testTimer = setInterval(() => {
                        this.testTimeLeft--;
                        if (this.testTimeLeft <= 0) {
                            this.submitTest();
                        }
                    }, 1000);
                },
                
                submitTest() {
                    if (this.testTimer) {
                        clearInterval(this.testTimer);
                    }
                    
                    let correctAnswers = 0;
                    const totalQuestions = this.currentTest.questions.length;
                    
                    this.currentTest.questions.forEach(question => {
                        if (this.testAnswers[question.id] === question.correctAnswer) {
                            correctAnswers++;
                        }
                    });
                    
                    const score = Math.round((correctAnswers / totalQuestions) * 100);
                    const timeTaken = this.formatTime(this.currentTest.timeLimit * 60 - this.testTimeLeft);
                    
                    const result = {
                        id: Date.now(),
                        testTitle: this.currentTest.title,
                        subject: this.currentTest.subject,
                        score: score,
                        correctAnswers: correctAnswers,
                        totalQuestions: totalQuestions,
                        timeTaken: timeTaken,
                        date: new Date().toLocaleDateString()
                    };
                    
                    this.testResults.unshift(result);
                    
                    // Update user stats
                    this.updateUserStats('testCompleted', 0); // Award 50 points for test completion
                    
                    // Award bonus points based on score
                    if (score >= 90) {
                        this.updateUserStats('pointsEarned', 50); // Bonus for excellent score
                    } else if (score >= 70) {
                        this.updateUserStats('pointsEarned', 25); // Bonus for good score
                    }
                    
                    this.showTestPage = false;
                    this.currentTest = null;
                    this.testTimeLeft = 0;
                    this.testAnswers = {};
                    
                    alert(`Test completed!\nScore: ${score}%\nCorrect: ${correctAnswers}/${totalQuestions}\nTime: ${timeTaken}\n\nPoints earned: ${score >= 90 ? 100 : score >= 70 ? 75 : 50}`);
                },
                
                formatTime(seconds) {
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                },
                
                // Flash Cards Methods
                flipCard() {
                    this.isFlipped = !this.isFlipped;
                },
                
                nextCard() {
                    if (this.currentCardIndex < this.flashcards.length - 1) {
                        this.currentCardIndex++;
                        this.isFlipped = false;
                    }
                },
                
                previousCard() {
                    if (this.currentCardIndex > 0) {
                        this.currentCardIndex--;
                        this.isFlipped = false;
                    }
                },
                
                toggleStudyMode() {
                    this.studyMode = this.studyMode === 'review' ? 'test' : 'review';
                    this.resetStudyStats();
                },
                
                shuffleCards() {
                    // Fisher-Yates shuffle algorithm
                    for (let i = this.flashcards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [this.flashcards[i], this.flashcards[j]] = [this.flashcards[j], this.flashcards[i]];
                    }
                    this.currentCardIndex = 0;
                    this.isFlipped = false;
                },
                
                rateCard(rating) {
                    if (this.flashcards[this.currentCardIndex]) {
                        this.flashcards[this.currentCardIndex].userRating = rating;
                        
                        // Update study stats
                        if (rating >= 2) {
                            this.studyStats.correct++;
                        } else {
                            this.studyStats.incorrect++;
                        }
                        
                        this.updateAccuracy();
                        
                        // Auto-advance to next card after rating
                        setTimeout(() => {
                            if (this.currentCardIndex < this.flashcards.length - 1) {
                                this.nextCard();
                            }
                        }, 1000);
                    }
                },
                
                updateAccuracy() {
                    const total = this.studyStats.correct + this.studyStats.incorrect;
                    this.studyStats.accuracy = total > 0 ? Math.round((this.studyStats.correct / total) * 100) : 0;
                },
                
                resetStudyStats() {
                    this.studyStats = {
                        correct: 0,
                        incorrect: 0,
                        accuracy: 0
                    };
                },
                
                // Flashcard Creation Methods
                createFlashcard() {
                    if (!this.newFlashcard.question.trim() || !this.newFlashcard.answer.trim()) {
                        alert('Please fill in both question and answer fields.');
                        return;
                    }
                    
                    this.showLoading();
                    
                    // Simulate processing time for better UX
                    setTimeout(() => {
                        const newCard = {
                            id: Date.now(),
                            question: this.newFlashcard.question,
                            answer: this.newFlashcard.answer,
                            type: this.newFlashcard.type,
                            difficulty: parseInt(this.newFlashcard.difficulty),
                            explanation: this.newFlashcard.explanation,
                            relatedTerms: this.newFlashcard.relatedTerms,
                            questionImage: this.newFlashcard.questionImage,
                            answerImage: this.newFlashcard.answerImage,
                            userRating: null
                        };
                        
                        this.flashcards.push(newCard);
                        
                        // Reset form
                        this.newFlashcard = {
                            question: '',
                            answer: '',
                            type: '',
                            difficulty: 1,
                            explanation: '',
                            relatedTerms: '',
                            questionImage: null,
                            answerImage: null
                        };
                        
                        this.showCreateFlashcard = false;
                        this.hideLoading();
                        
                        // Show success message with animation
                        alert('Flashcard created successfully!');
                    }, 1000);
                },
                
                handleImageUpload(event, type) {
                    const file = event.target.files[0];
                    if (file) {
                        // Check file size (max 5MB)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('Image size must be less than 5MB');
                            return;
                        }
                        
                        // Check file type
                        if (!file.type.startsWith('image/')) {
                            alert('Please select an image file');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            if (type === 'question') {
                                this.newFlashcard.questionImage = e.target.result;
                            } else {
                                this.newFlashcard.answerImage = e.target.result;
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                },
                
                
                
                // Keyboard Shortcuts
                handleKeydown(event) {
                    // Only handle shortcuts when not in input fields
                    if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
                    
                    switch (event.key) {
                        case ' ':
                            event.preventDefault();
                            if (this.showFlashcards && this.flashcards.length > 0) {
                                this.flipCard();
                            }
                            break;
                        case 'ArrowRight':
                            event.preventDefault();
                            if (this.showFlashcards && this.flashcards.length > 0) {
                                this.nextCard();
                            }
                            break;
                        case 'ArrowLeft':
                            event.preventDefault();
                            if (this.showFlashcards && this.flashcards.length > 0) {
                                this.previousCard();
                            }
                            break;
                    }
                    
                },
                
                // Loading Methods
                showLoading() {
                    this.isLoading = true;
                },
                
                hideLoading() {
                    this.isLoading = false;
                },
                
                
                // Educator Tools Methods
                createClass() {
                    if (!this.newClass.name.trim() || !this.newClass.subject.trim() || !this.newClass.grade) {
                        alert('Please fill in all required fields.');
                        return;
                    }
                    
                    const newClass = {
                        id: Date.now(),
                        name: this.newClass.name,
                        subject: this.newClass.subject,
                        grade: this.newClass.grade,
                        description: this.newClass.description,
                        students: [],
                        createdAt: new Date().toISOString()
                    };
                    
                    this.classes.push(newClass);
                    
                    // Reset form
                    this.newClass = {
                        name: '',
                        subject: '',
                        grade: '',
                        description: '',
                        students: []
                    };
                    
                    alert('Class created successfully!');
                },
                
                editClass(classItem) {
                    // For now, just show an alert. In a real app, you'd open an edit modal
                    alert(`Edit class: ${classItem.name}`);
                },
                
                deleteClass(classId) {
                    if (confirm('Are you sure you want to delete this class?')) {
                        this.classes = this.classes.filter(c => c.id !== classId);
                    }
                },
                
                createAssignment() {
                    if (!this.newAssignment.title.trim() || !this.newAssignment.classId || this.newAssignment.flashcardIds.length === 0) {
                        alert('Please fill in all required fields and select at least one flashcard.');
                        return;
                    }
                    
                    const newAssignment = {
                        id: Date.now(),
                        title: this.newAssignment.title,
                        description: this.newAssignment.description,
                        classId: this.newAssignment.classId,
                        flashcardIds: this.newAssignment.flashcardIds,
                        dueDate: this.newAssignment.dueDate,
                        instructions: this.newAssignment.instructions,
                        createdAt: new Date().toISOString(),
                        status: 'active'
                    };
                    
                    this.assignments.push(newAssignment);
                    
                    // Reset form
                    this.newAssignment = {
                        title: '',
                        description: '',
                        classId: '',
                        flashcardIds: [],
                        dueDate: '',
                        instructions: ''
                    };
                    
                    alert('Assignment created successfully!');
                },
                
                viewAssignment(assignment) {
                    // For now, just show an alert. In a real app, you'd open a detailed view
                    alert(`View assignment: ${assignment.title}`);
                },
                
                deleteAssignment(assignmentId) {
                    if (confirm('Are you sure you want to delete this assignment?')) {
                        this.assignments = this.assignments.filter(a => a.id !== assignmentId);
                    }
                },
                
                getClassById(classId) {
                    return this.classes.find(c => c.id === classId);
                },
                
                getStudentProgress(studentId) {
                    // Mock progress calculation - in a real app, this would be calculated from actual data
                    return Math.floor(Math.random() * 100);
                },
                
                selectAllStudents() {
                    this.selectedStudents = [];
                    this.classes.forEach(classItem => {
                        classItem.students.forEach(student => {
                            this.selectedStudents.push(student.id);
                        });
                    });
                },
                
                clearSelection() {
                    this.selectedStudents = [];
                },
                
                formatDate(dateString) {
                    if (!dateString) return 'No date set';
                    const date = new Date(dateString);
                    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                },
                
                async clearAllFiles() {
                    if (confirm('Are you sure you want to delete ALL uploaded files? This action cannot be undone.')) {
                        try {
                            // First, get all file IDs from the database
                            const getResponse = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/resources?select=id', {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                                }
                            });

                            if (getResponse.ok) {
                                const files = await getResponse.json();
                                console.log('Found files to delete:', files.length);
                                
                                // Delete each file individually
                                for (const file of files) {
                                    try {
                                        await fetch(`https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/resources?id=eq.${file.id}`, {
                                            method: 'DELETE',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                                            }
                                        });
                                        console.log('Deleted file:', file.id);
                                    } catch (deleteError) {
                                        console.error('Error deleting file:', file.id, deleteError);
                                    }
                                }
                            }

                            // Clear local arrays
                            this.uploadedFiles = [];
                            this.resources = [];
                            
                            // Clear localStorage
                            localStorage.removeItem('uploadedFiles');
                            
                            alert('All files have been permanently deleted from database and local storage!');
                            
                        } catch (error) {
                            console.error('Error clearing files:', error);
                            // Even if database fails, clear local data
                            this.uploadedFiles = [];
                            this.resources = [];
                            localStorage.removeItem('uploadedFiles');
                            alert('Files cleared locally. Database deletion may have failed, but files won\'t show on refresh.');
                        }
                    }
                },
                
                // Quick fix method to remove specific files
                removeSpecificFile(fileName) {
                    if (confirm(`Are you sure you want to delete "${fileName}"?`)) {
                        // Remove from uploadedFiles array
                        this.uploadedFiles = this.uploadedFiles.filter(file => file.name !== fileName);
                        
                        // Remove from resources array
                        this.resources = this.resources.filter(resource => resource.name !== fileName);
                        
                        // Update localStorage
                        localStorage.setItem('uploadedFiles', JSON.stringify(this.uploadedFiles));
                        
                        alert(`"${fileName}" has been deleted!`);
                    }
                },
                
                // Force clear all files - more aggressive approach
                forceClearAllFiles() {
                    if (confirm('FORCE CLEAR: This will delete ALL files from database and local storage. This action cannot be undone!')) {
                        // Clear everything immediately
                        this.uploadedFiles = [];
                        this.resources = [];
                        
                        // Clear all localStorage keys related to files
                        localStorage.removeItem('uploadedFiles');
                        localStorage.removeItem('resources');
                        
                        // Clear any other potential storage
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && (key.includes('file') || key.includes('resource') || key.includes('upload'))) {
                                localStorage.removeItem(key);
                            }
                        }
                        
                        alert('FORCE CLEAR COMPLETE: All files have been removed from local storage. Refresh the page to see the changes.');
                        
                        // Force reload the page to clear any cached data
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }
                },
                
                // Nuclear clear - ultimate solution
                nuclearClear() {
                    if (confirm('🚨 NUCLEAR CLEAR 🚨\n\nThis will:\n- Clear ALL files from memory\n- Clear ALL localStorage\n- Clear ALL sessionStorage\n- Reload the page\n\nThis action cannot be undone!')) {
                        this.uploadedFiles = [];
                        this.resources = [];
                        localStorage.clear();
                        sessionStorage.clear();
                        
                        // Also clear any cached data
                        if ('caches' in window) {
                            caches.keys().then(names => {
                                names.forEach(name => {
                                    caches.delete(name);
                                });
                            });
                        }
                        
                        alert('NUCLEAR CLEAR COMPLETE! Page will reload in 3 seconds...');
                        setTimeout(() => {
                            window.location.reload(true); // Force reload from server
                        }, 3000);
                    }
                },
                
                // Load uploaded files from localStorage
                loadUploadedFiles() {
                    try {
                        const storedFiles = localStorage.getItem('uploadedFiles');
                        if (storedFiles) {
                            this.uploadedFiles = JSON.parse(storedFiles);
                            console.log('Loaded files from localStorage:', this.uploadedFiles.length);
                        }
                    } catch (error) {
                        console.error('Error loading files from localStorage:', error);
                        this.uploadedFiles = [];
                    }
                },
                
                // Chatbot Methods
                sendMessage() {
                    if (!this.chatInput.trim()) return;
                    
                    const userMessage = {
                        id: Date.now(),
                        sender: 'user',
                        text: this.chatInput.trim(),
                        time: new Date().toLocaleTimeString()
                    };
                    
                    this.chatMessages.push(userMessage);
                    const userInput = this.chatInput.trim();
                    this.chatInput = '';
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const aiResponse = this.generateAIResponse(userInput);
                        const aiMessage = {
                            id: Date.now() + 1,
                            sender: 'ai',
                            text: aiResponse,
                            time: new Date().toLocaleTimeString()
                        };
                        this.chatMessages.push(aiMessage);
                    }, 1000);
                },
                
                generateAIResponse(input) {
                    const lowerInput = input.toLowerCase();
                    
                    // Greeting responses
                    if (lowerInput.includes('hello') || lowerInput.includes('hi') || lowerInput.includes('hey')) {
                        return "Hello! I'm your AI study assistant. How can I help you with your engineering studies today?";
                    }
                    
                    // Good morning messages
                    if (lowerInput.includes('good morning') || lowerInput.includes('morning message')) {
                        return "Good morning! Here are some motivational messages for your studies:\n\n• 'Every expert was once a beginner. Every pro was once an amateur.'\n• 'The future belongs to those who believe in the beauty of their dreams.'\n• 'Success is not final, failure is not fatal: it is the courage to continue that counts.'\n\nHave a great day of learning! 🌅";
                    }
                    
                    // Math/Calculus help
                    if (lowerInput.includes('calculus') || lowerInput.includes('derivative') || lowerInput.includes('integral')) {
                        return "I'd be happy to help with calculus! Here are some key concepts:\n\n• Derivatives: Rate of change\n• Integrals: Area under curves\n• Chain rule: d/dx[f(g(x))] = f'(g(x)) × g'(x)\n• Product rule: d/dx[f(x)g(x)] = f'(x)g(x) + f(x)g'(x)\n\nWhat specific calculus problem are you working on?";
                    }
                    
                    // Physics/Mechanics help
                    if (lowerInput.includes('physics') || lowerInput.includes('mechanics') || lowerInput.includes('force') || lowerInput.includes('newton')) {
                        return "Physics and mechanics are fascinating! Here are some fundamental concepts:\n\n• Newton's Laws: F = ma, action-reaction, inertia\n• Energy: KE = ½mv², PE = mgh\n• Momentum: p = mv\n• Work: W = Fd cos(θ)\n\nWhat specific physics concept would you like to explore?";
                    }
                    
                    // Engineering help
                    if (lowerInput.includes('engineering') || lowerInput.includes('design') || lowerInput.includes('circuit')) {
                        return "Engineering is all about solving real-world problems! Here are some key areas:\n\n• Mechanical: Forces, motion, materials\n• Electrical: Circuits, power, electronics\n• Civil: Structures, infrastructure\n• Chemical: Processes, reactions\n\nWhich engineering discipline interests you most?";
                    }
                    
                    // Study tips
                    if (lowerInput.includes('study') || lowerInput.includes('learn') || lowerInput.includes('exam')) {
                        return "Great question about studying! Here are some effective study strategies:\n\n• Active recall: Test yourself regularly\n• Spaced repetition: Review material over time\n• Practice problems: Solve many examples\n• Study groups: Learn with peers\n• Break it down: Tackle complex topics in parts\n\nWhat subject are you studying for?";
                    }
                    
                    // General help
                    if (lowerInput.includes('help') || lowerInput.includes('confused') || lowerInput.includes('stuck')) {
                        return "I'm here to help! I can assist with:\n\n• Engineering concepts and formulas\n• Study strategies and tips\n• Problem-solving approaches\n• Academic motivation\n• Course material explanations\n\nWhat specific topic would you like help with?";
                    }
                    
                    // Default responses for other queries
                    const defaultResponses = [
                        "That's an interesting question! I'm here to help with your engineering studies. Could you be more specific about what you'd like to learn?",
                        "I'd be happy to help! I specialize in engineering and academic topics. What subject are you working on?",
                        "Great question! I can help with engineering concepts, study tips, and academic guidance. What would you like to explore?",
                        "I'm your AI study assistant! I can help with engineering topics, math problems, physics concepts, and study strategies. What do you need help with?",
                        "That's a good question! I'm designed to help with engineering and academic studies. Could you tell me more about what you're working on?"
                    ];
                    
                    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
                },
                
                // Resource Methods for Students
                downloadResource(resource) {
                    if (resource.content) {
                        // Convert base64 to blob and download
                        const byteCharacters = atob(resource.content.split(',')[1]);
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: this.getMimeType(resource.type) });
                        
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = resource.name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        alert(`Downloading ${resource.name}...`);
                    } else {
                        alert('Resource not available for download.');
                    }
                },
                
                previewResource(resource) {
                    if (resource.content) {
                        // Open resource in new window for preview
                        const byteCharacters = atob(resource.content.split(',')[1]);
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: this.getMimeType(resource.type) });
                        
                        const url = URL.createObjectURL(blob);
                        window.open(url, '_blank');
                        
                        // Clean up after a delay
                        setTimeout(() => URL.revokeObjectURL(url), 1000);
                    } else {
                        alert('Resource not available for preview.');
                    }
                },
                
                getMimeType(fileType) {
                    const mimeTypes = {
                        'PDF': 'application/pdf',
                        'DOC': 'application/msword',
                        'DOCX': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'PPT': 'application/vnd.ms-powerpoint',
                        'PPTX': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                        'JPG': 'image/jpeg',
                        'PNG': 'image/png',
                        'GIF': 'image/gif'
                    };
                    return mimeTypes[fileType] || 'application/octet-stream';
                },
                
                // Course Planner Methods
                async createCoursePlan() {
                    if (!this.coursePlan.title.trim() || !this.coursePlan.description.trim()) {
                        alert('Please fill in all required fields!');
                        return;
                    }
                    
                    try {
                        const courseData = {
                            title: this.coursePlan.title.trim(),
                            description: this.coursePlan.description.trim(),
                            start_date: this.coursePlan.startDate || null,
                            end_date: this.coursePlan.endDate || null,
                            topics: JSON.stringify(this.coursePlan.topics),
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString(),
                            status: 'active'
                        };
                        
                        // Save to Supabase database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/courses', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(courseData)
                        });
                        
                        if (response.ok) {
                            alert('Course plan created and saved to database successfully!');
                            
                            // Clear form
                            this.coursePlan = {
                                title: '',
                                description: '',
                                startDate: '',
                                endDate: '',
                                topics: []
                            };
                        } else {
                            throw new Error('Failed to save to database');
                        }
                    } catch (error) {
                        alert('Failed to create course plan in database. Please try again.');
                        console.error('Error creating course plan:', error);
                    }
                },
                
                loadUserStats() {
                    // For new users, start with 0 stats
                    // For existing users, load from database or localStorage
                    const savedStats = localStorage.getItem(`userStats_${this.user.id}`);
                    
                    if (savedStats) {
                        try {
                            this.userStats = JSON.parse(savedStats);
                        } catch (error) {
                            console.error('Error parsing user stats:', error);
                            this.initializeNewUserStats();
                        }
                    } else {
                        // New user - initialize with 0 stats
                        this.initializeNewUserStats();
                    }
                },
                
                initializeNewUserStats() {
                    this.userStats = {
                        coursesCompleted: 0,
                        currentStreak: 0,
                        learningPoints: 0
                    };
                    
                    // Save to localStorage
                    this.saveUserStats();
                },
                
                saveUserStats() {
                    try {
                        localStorage.setItem(`userStats_${this.user.id}`, JSON.stringify(this.userStats));
                    } catch (error) {
                        console.error('Error saving user stats:', error);
                    }
                },
                
                updateUserStats(type, value) {
                    switch (type) {
                        case 'courseCompleted':
                            this.userStats.coursesCompleted += value;
                            this.userStats.learningPoints += 100; // Award points for course completion
                            break;
                        case 'streakUpdate':
                            this.userStats.currentStreak = value;
                            break;
                        case 'pointsEarned':
                            this.userStats.learningPoints += value;
                            break;
                        case 'testCompleted':
                            this.userStats.learningPoints += 50; // Award points for test completion
                            break;
                    }
                    
                    this.saveUserStats();
                },
                
                updateDailyStreak() {
                    const today = new Date().toDateString();
                    const lastLogin = localStorage.getItem(`lastLogin_${this.user.id}`);
                    
                    if (lastLogin === today) {
                        // Already logged in today, no streak update needed
                        return;
                    }
                    
                    if (lastLogin) {
                        const lastLoginDate = new Date(lastLogin);
                        const todayDate = new Date();
                        const daysDiff = Math.floor((todayDate - lastLoginDate) / (1000 * 60 * 60 * 24));
                        
                        if (daysDiff === 1) {
                            // Consecutive day - increment streak
                            this.userStats.currentStreak += 1;
                        } else if (daysDiff > 1) {
                            // Streak broken - reset to 1
                            this.userStats.currentStreak = 1;
                        }
                    } else {
                        // First time login - start streak at 1
                        this.userStats.currentStreak = 1;
                    }
                    
                    // Update last login date
                    localStorage.setItem(`lastLogin_${this.user.id}`, today);
                    
                    // Save updated stats
                    this.saveUserStats();
                },
                
                // Custom Question Creator Methods
                addCustomQuestion() {
                    if (!this.newQuestion.question.trim()) {
                        alert('Please enter a question!');
                        return;
                    }
                    
                    if (this.newQuestion.options.some(opt => !opt.trim())) {
                        alert('Please fill in all options!');
                        return;
                    }
                    
                    if (!this.newQuestion.correctAnswer) {
                        alert('Please select the correct answer!');
                        return;
                    }
                    
                    const question = {
                        id: Date.now() + Math.random(),
                        question: this.newQuestion.question,
                        options: [...this.newQuestion.options],
                        correctAnswer: this.newQuestion.correctAnswer
                    };
                    
                    this.customQuestions.push(question);
                    this.clearNewQuestion();
                },
                
                clearNewQuestion() {
                    this.newQuestion = {
                        question: '',
                        options: ['', '', '', ''],
                        correctAnswer: ''
                    };
                },
                
                removeCustomQuestion(index) {
                    if (confirm('Are you sure you want to remove this question?')) {
                        this.customQuestions.splice(index, 1);
                    }
                },
                
                previewCustomTest() {
                    if (this.customQuestions.length === 0) {
                        alert('No questions to preview!');
                        return;
                    }
                    
                    let preview = `Test: ${this.customTestConfig.title}\n`;
                    preview += `Subject: ${this.customTestConfig.subject}\n`;
                    preview += `Difficulty: ${this.customTestConfig.difficulty}\n`;
                    preview += `Time Limit: ${this.customTestConfig.timeLimit} minutes\n\n`;
                    
                    this.customQuestions.forEach((q, index) => {
                        preview += `${index + 1}. ${q.question}\n`;
                        q.options.forEach((opt, optIndex) => {
                            preview += `   ${String.fromCharCode(65 + optIndex)}) ${opt}\n`;
                        });
                        preview += `   Correct Answer: ${q.correctAnswer}\n\n`;
                    });
                    
                    alert(preview);
                },
                
                async saveCustomTest() {
                    if (this.customQuestions.length === 0) {
                        alert('No questions to save!');
                        return;
                    }
                    
                    if (!this.customTestConfig.title.trim() || !this.customTestConfig.subject.trim()) {
                        alert('Please fill in test title and subject!');
                        return;
                    }
                    
                    try {
                        const testData = {
                            title: this.customTestConfig.title,
                            subject: this.customTestConfig.subject,
                            difficulty: this.customTestConfig.difficulty,
                            time_limit: this.customTestConfig.timeLimit,
                            questions: JSON.stringify(this.customQuestions),
                            test_code: this.generateTestCode(),
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString(),
                            status: 'draft'
                        };
                        
                        // Save to database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/tests', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(testData)
                        });
                        
                        if (response.ok) {
                            alert('Custom test saved successfully!');
                            this.customQuestions = [];
                            this.customTestConfig = {
                                title: '',
                                subject: '',
                                difficulty: 'Medium',
                                timeLimit: 60
                            };
                        } else {
                            alert('Failed to save test. Please try again.');
                        }
                    } catch (error) {
                        alert('Error saving test. Please try again.');
                        console.error('Error saving custom test:', error);
                    }
                },
                
                async publishCustomTest() {
                    if (this.customQuestions.length === 0) {
                        alert('No questions to publish!');
                        return;
                    }
                    
                    if (!this.customTestConfig.title.trim() || !this.customTestConfig.subject.trim()) {
                        alert('Please fill in test title and subject!');
                        return;
                    }
                    
                    try {
                        const testCode = this.generateTestCode();
                        const testData = {
                            title: this.customTestConfig.title,
                            subject: this.customTestConfig.subject,
                            difficulty: this.customTestConfig.difficulty,
                            time_limit: this.customTestConfig.timeLimit,
                            questions: JSON.stringify(this.customQuestions),
                            test_code: testCode,
                            created_by: this.user.id,
                            created_by_name: this.user.name,
                            created_at: new Date().toISOString(),
                            status: 'published'
                        };
                        
                        // Save to database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/tests', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(testData)
                        });
                        
                        if (response.ok) {
                            // Add to published tests
                            const publishedTest = {
                                id: Date.now() + Math.random(),
                                title: this.customTestConfig.title,
                                subject: this.customTestConfig.subject,
                                difficulty: this.customTestConfig.difficulty,
                                timeLimit: this.customTestConfig.timeLimit,
                                time_limit: this.customTestConfig.timeLimit,
                                questions: this.customQuestions,
                                code: testCode,
                                test_code: testCode,
                                created_by: this.user.id,
                                created_by_name: this.user.name,
                                created_at: new Date().toISOString()
                            };
                            this.publishedTests.push(publishedTest);
                            
                            // Sync with available tests
                            this.syncAvailableTests();
                            
                            alert(`Custom test published successfully! Test Code: ${testCode}`);
                            
                            // Clear form
                            this.customQuestions = [];
                            this.customTestConfig = {
                                title: '',
                                subject: '',
                                difficulty: 'Medium',
                                timeLimit: 60
                            };
                        } else {
                            alert('Failed to publish test. Please try again.');
                        }
                    } catch (error) {
                        alert('Error publishing test. Please try again.');
                        console.error('Error publishing custom test:', error);
                    }
                },
                
                // Resource Upload Methods
                handleFileSelect(event) {
                    const files = Array.from(event.target.files);
                    this.processFiles(files);
                },
                
                handleFileDrop(event) {
                    this.isDragOver = false;
                    const files = Array.from(event.dataTransfer.files);
                    this.processFiles(files);
                },
                
                processFiles(files) {
                    if (files.length === 0) return;
                    
                    // Validate file types and sizes
                    const allowedTypes = [
                        'application/pdf',
                        'application/msword',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'application/vnd.ms-powerpoint',
                        'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                        'image/jpeg',
                        'image/jpg',
                        'image/png',
                        'image/gif'
                    ];
                    
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    
                    for (const file of files) {
                        if (!allowedTypes.includes(file.type)) {
                            alert(`File "${file.name}" is not a supported format. Please upload PDF, DOC, PPT, or image files.`);
                            continue;
                        }
                        
                        if (file.size > maxSize) {
                            alert(`File "${file.name}" is too large. Please upload files smaller than 10MB.`);
                            continue;
                        }
                        
                        this.uploadFile(file);
                    }
                },
                
                async uploadFile(file) {
                    this.isUploading = true;
                    this.uploadProgress = 0;
                    
                    try {
                        // Simulate file upload with progress
                        const uploadInterval = setInterval(() => {
                            this.uploadProgress += Math.random() * 20;
                            if (this.uploadProgress >= 100) {
                                this.uploadProgress = 100;
                                clearInterval(uploadInterval);
                                this.saveFileToDatabase(file);
                                this.isUploading = false;
                                this.uploadProgress = 0;
                            }
                        }, 200);
                        
                    } catch (error) {
                        alert('Failed to upload file. Please try again.');
                        console.error('Upload error:', error);
                        this.isUploading = false;
                        this.uploadProgress = 0;
                    }
                },
                
                async saveFileToDatabase(file) {
                    try {
                        // Convert file to base64 for storage
                        const base64File = await this.fileToBase64(file);
                        
                        const fileData = {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            file_type: this.getFileType(file.type),
                            content: base64File,
                            uploaded_by: this.user.id,
                            uploaded_by_name: this.user.name,
                            uploaded_at: new Date().toISOString(),
                            is_public: true // Make resources accessible to students
                        };
                        
                        // Save to Supabase database
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/resources', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            },
                            body: JSON.stringify(fileData)
                        });
                        
                        if (response.ok) {
                            const savedFile = await response.json();
                            console.log('Database response:', savedFile);
                            
                            // Add the database-generated ID to our file data
                            if (savedFile && savedFile.length > 0) {
                                fileData.id = savedFile[0].id;
                            } else {
                                // Fallback: generate a temporary ID
                                fileData.id = Math.floor(Date.now() / 1000) + Math.floor(Math.random() * 1000);
                            }
                            
                            this.addFileToList(fileData);
                            console.log('Added file to list:', fileData);
                            alert(`File "${file.name}" uploaded and saved to database successfully!`);
                        } else {
                            const errorText = await response.text();
                            console.error('Database save error:', response.status, errorText);
                            
                            if (response.status === 404) {
                                alert('Database tables not found. Please create the required tables in Supabase first.\n\nGo to Supabase Dashboard → SQL Editor → Run the SQL from create-tables.sql');
                            } else if (response.status === 401) {
                                alert('Authentication failed. Please log in again.');
                            } else {
                                alert(`Database error: ${response.status} - ${errorText}`);
                            }
                            throw new Error(`Database error: ${response.status}`);
                        }
                        
                    } catch (error) {
                        console.error('Database save error:', error);
                        // Fallback: Save to localStorage
                        this.saveFileToLocalStorage(fileData);
                        alert(`File "${file.name}" uploaded but saved locally only. Database connection failed.`);
                    }
                },
                
                saveFileToLocalStorage(fileData) {
                    try {
                        // Generate a proper integer ID for localStorage
                        fileData.id = Math.floor(Date.now() / 1000) + Math.floor(Math.random() * 1000);
                        
                        const resourcesKey = `resources_${this.user.id}`;
                        const existingResources = JSON.parse(localStorage.getItem(resourcesKey) || '[]');
                        existingResources.push(fileData);
                        localStorage.setItem(resourcesKey, JSON.stringify(existingResources));
                        this.addFileToList(fileData);
                    } catch (error) {
                        console.error('Error saving file to localStorage:', error);
                    }
                },
                
                fileToBase64(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = () => {
                            // Extract base64 data (remove data:type;base64, prefix)
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = error => reject(error);
                    });
                },
                
                addFileToList(fileData) {
                    console.log('Adding file to list:', fileData);
                    console.log('Current uploadedFiles before:', this.uploadedFiles);
                    
                    const displayData = {
                        id: fileData.id,
                        name: fileData.name,
                        size: this.formatFileSize(fileData.size),
                        type: fileData.file_type,
                        uploadDate: new Date(fileData.uploaded_at).toLocaleString(),
                        uploadedBy: fileData.uploaded_by_name,
                        content: fileData.content
                    };
                    
                    this.uploadedFiles.push(displayData);
                    console.log('Current uploadedFiles after:', this.uploadedFiles);
                    
                    // Force Vue reactivity update
                    this.$forceUpdate();
                },
                
                downloadFile(file) {
                    try {
                        // Create a blob from the base64 content
                        const byteCharacters = atob(file.content);
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: 'application/octet-stream' });
                        
                        // Create download link
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file.name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Download error:', error);
                        alert('Failed to download file');
                    }
                },
                
                deleteFile(file) {
                    if (confirm(`Are you sure you want to delete "${file.name}"?`)) {
                        // Remove from uploadedFiles array
                        const index = this.uploadedFiles.findIndex(f => f.id === file.id);
                        if (index > -1) {
                            this.uploadedFiles.splice(index, 1);
                        
                            // Update localStorage to persist the deletion
                            localStorage.setItem('uploadedFiles', JSON.stringify(this.uploadedFiles));
                            
                        console.log('File deleted:', file.name);
                        }
                    }
                },
                
                loadUploadedFiles() {
                    // Load files from the resources array (which comes from database)
                    this.uploadedFiles = this.resources.map(resource => ({
                        id: resource.id,
                        name: resource.name,
                        size: resource.size,
                        type: resource.type,
                        uploadDate: resource.uploadDate,
                        uploadedBy: resource.uploadedBy,
                        content: resource.content
                    }));
                    console.log('Loaded uploaded files:', this.uploadedFiles);
                },
                
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },
                
                getFileType(mimeType) {
                    const typeMap = {
                        'application/pdf': 'PDF',
                        'application/msword': 'DOC',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'DOCX',
                        'application/vnd.ms-powerpoint': 'PPT',
                        'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PPTX',
                        'image/jpeg': 'JPG',
                        'image/jpg': 'JPG',
                        'image/png': 'PNG',
                        'image/gif': 'GIF'
                    };
                    return typeMap[mimeType] || 'FILE';
                },
                
                downloadFile(file) {
                    if (file.content) {
                        // Convert base64 to blob and download
                        const byteCharacters = atob(file.content.split(',')[1]);
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: file.type || 'application/octet-stream' });
                        
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file.name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    } else {
                        alert('File not available for download.');
                    }
                },
                
                deleteFileFromUI(file) {
                    if (confirm(`Are you sure you want to delete "${file.name}"?`)) {
                        this.deleteFileFromDatabase(file);
                    }
                },
                
                async deleteFileFromDatabase(file) {
                    try {
                        const response = await fetch(`https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/resources?id=eq.${file.id}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            }
                        });
                        
                        if (response.ok) {
                            const index = this.uploadedFiles.findIndex(f => f.id === file.id);
                            if (index > -1) {
                                this.uploadedFiles.splice(index, 1);
                            }
                            
                            // Also remove from resources array
                            const resourceIndex = this.resources.findIndex(r => r.id === file.id);
                            if (resourceIndex > -1) {
                                this.resources.splice(resourceIndex, 1);
                            }
                            
                            // Update localStorage to persist the deletion
                            localStorage.setItem('uploadedFiles', JSON.stringify(this.uploadedFiles));
                            
                            alert('File deleted successfully!');
                        } else {
                            throw new Error('Failed to delete from database');
                        }
                    } catch (error) {
                        console.error('Delete error:', error);
                        alert('Failed to delete file. Please try again.');
                    }
                },
                
                async loadResourcesFromDatabase() {
                    try {
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/resources?is_public=eq.true&order=uploaded_at.desc', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            }
                        });
                        
                        if (response.ok) {
                            const resources = await response.json();
                            this.resources = resources.map(resource => ({
                                id: resource.id,
                                name: resource.name,
                                size: this.formatFileSize(resource.size),
                                type: resource.file_type,
                                uploadDate: new Date(resource.uploaded_at).toLocaleString(),
                                uploadedBy: resource.uploaded_by_name,
                                content: resource.content
                            }));
                        }
                    } catch (error) {
                        console.error('Error loading resources:', error);
                    }
                },
                
                async loadStudentsFromDatabase() {
                    try {
                        // Load all students (not just those created by current educator)
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/students?select=*&order=signup_date.desc', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            }
                        });
                        
                        if (response.ok) {
                            const students = await response.json();
                            const previousCount = this.students.length;
                            
                            this.students = students.map(student => ({
                                id: student.id,
                                firstName: student.first_name,
                                lastName: student.last_name,
                                name: `${student.first_name} ${student.last_name}`,
                                email: student.email,
                                progress: student.progress || 0,
                                joinDate: student.signup_date ? new Date(student.signup_date).toLocaleDateString() : 'Unknown',
                                status: student.status || 'Active',
                                userId: student.user_id
                            }));
                            
                            // Show notification if new students were added
                            if (this.students.length > previousCount && previousCount > 0) {
                                const newCount = this.students.length - previousCount;
                                this.showNewStudentNotification(newCount);
                            }
                        } else if (response.status === 404) {
                            // Table doesn't exist yet, load from localStorage
                            console.log('Students table not found, loading from localStorage');
                            this.loadStudentsFromLocalStorage();
                        }
                    } catch (error) {
                        console.error('Error loading students:', error);
                        // Load from localStorage if there's an error
                        this.loadStudentsFromLocalStorage();
                    }
                },
                
                // LocalStorage methods for students
                saveStudentsToLocalStorage() {
                    try {
                        const studentsKey = `students_${this.user.id}`;
                        localStorage.setItem(studentsKey, JSON.stringify(this.students));
                    } catch (error) {
                        console.error('Error saving students to localStorage:', error);
                    }
                },
                
                showNewStudentNotification(count) {
                    this.newStudentNotification = `${count} new student${count > 1 ? 's' : ''} joined!`;
                    setTimeout(() => {
                        this.newStudentNotification = null;
                    }, 5000); // Hide after 5 seconds
                },
                
                loadStudentsFromLocalStorage() {
                    try {
                        const studentsKey = `students_${this.user.id}`;
                        const savedStudents = localStorage.getItem(studentsKey);
                        if (savedStudents) {
                            this.students = JSON.parse(savedStudents);
                        }
                    } catch (error) {
                        console.error('Error loading students from localStorage:', error);
                    }
                },
                
                syncAvailableTests() {
                    // Convert published tests to available tests format for students
                    const publishedTestsForStudents = this.publishedTests.map(test => ({
                        id: test.id,
                        title: test.title,
                        subject: test.subject,
                        difficulty: test.difficulty,
                        timeLimit: test.time_limit || test.timeLimit,
                        questions: typeof test.questions === 'string' ? JSON.parse(test.questions) : test.questions,
                        code: test.code || test.test_code,
                        createdBy: test.created_by_name || test.createdBy
                    }));
                    
                    // Merge with existing available tests (avoid duplicates)
                    const existingCodes = this.availableTests.map(t => t.code);
                    const newTests = publishedTestsForStudents.filter(test => !existingCodes.includes(test.code));
                    
                    this.availableTests = [...this.availableTests, ...newTests];
                    console.log('Synced available tests:', this.availableTests);
                },
                
                async loadTestsFromDatabase() {
                    try {
                        // Load ALL published tests (not just those created by current user)
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/tests?status=eq.published&order=created_at.desc', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            }
                        });
                        
                        if (response.ok) {
                            const tests = await response.json();
                            this.publishedTests = tests.map(test => ({
                                id: test.id,
                                title: test.title,
                                subject: test.subject,
                                difficulty: test.difficulty,
                                timeLimit: test.time_limit,
                                time_limit: test.time_limit, // Keep both formats
                                questions: JSON.parse(test.questions || '[]'),
                                code: test.test_code,
                                test_code: test.test_code, // Keep both formats
                                created_by: test.created_by,
                                created_by_name: test.created_by_name,
                                created_at: test.created_at
                            }));
                            
                            // Sync with available tests for students
                            this.syncAvailableTests();
                        }
                    } catch (error) {
                        console.error('Error loading tests:', error);
                    }
                },
                
                async loadCoursesFromDatabase() {
                    try {
                        const response = await fetch('https://cebrqzdpjksxozfqbetd.supabase.co/rest/v1/courses?created_by=eq.' + this.user.id + '&order=created_at.desc', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0',
                                'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlYnJxemRwamtzeG96ZnFiZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTIxMzcsImV4cCI6MjA3MzM2ODEzN30._kdp2jItLixL0LRiBjYYCIJvBYRg4VaF2ZgtwDfiEd0'
                            }
                        });
                        
                        if (response.ok) {
                            const courses = await response.json();
                            // Store courses for future use
                            this.courses = courses;
                        }
                    } catch (error) {
                        console.error('Error loading courses:', error);
                    }
                },
                
                // Initialize sample data
                initializeSampleData() {
                    // Sample performance data
                    this.performanceData = {
                        students: [
                            { id: 1, name: 'John Doe', lastScore: 85, average: 78, testsTaken: 5, status: 'Good' },
                            { id: 2, name: 'Jane Smith', lastScore: 92, average: 88, testsTaken: 7, status: 'Excellent' },
                            { id: 3, name: 'Mike Johnson', lastScore: 76, average: 72, testsTaken: 4, status: 'Good' },
                            { id: 4, name: 'Sarah Wilson', lastScore: 95, average: 91, testsTaken: 6, status: 'Excellent' }
                        ],
                        averageScore: 82,
                        totalTests: 22,
                        improvementRate: 15
                    };
                    
                    // Sample students
                    this.students = [
                        { id: 1, name: 'John Doe', email: 'john@example.com', progress: 78, lastActive: '2 hours ago' },
                        { id: 2, name: 'Jane Smith', email: 'jane@example.com', progress: 88, lastActive: '1 hour ago' },
                        { id: 3, name: 'Mike Johnson', email: 'mike@example.com', progress: 72, lastActive: '3 hours ago' },
                        { id: 4, name: 'Sarah Wilson', email: 'sarah@example.com', progress: 91, lastActive: '30 minutes ago' }
                    ];
                    
                    // Sample resources
                    this.resources = [
                        { id: 1, name: 'Calculus and Differential Equations.pdf', size: '2.3 MB', type: 'PDF' },
                        { id: 2, name: 'Engineering Mechanics Lab Report.docx', size: '1.8 MB', type: 'DOC' },
                        { id: 3, name: 'Circuit Analysis Presentation.pptx', size: '5.2 MB', type: 'PPT' }
                    ];
                    
                    // Sample uploaded files
                    this.uploadedFiles = [
                        { id: 1, name: 'Thermodynamics Notes.pdf', size: '2.3 MB', type: 'PDF', uploadDate: '2025-01-14 10:30 AM' },
                        { id: 2, name: 'Machine Design Presentation.pptx', size: '4.1 MB', type: 'PPTX', uploadDate: '2025-01-14 09:15 AM' },
                        { id: 3, name: 'CAD Drawing.png', size: '1.2 MB', type: 'PNG', uploadDate: '2025-01-14 08:45 AM' }
                    ];
                    
                    // Sample available tests for students
                    this.availableTests = [
                        {
                            id: 1,
                            title: 'Calculus Quiz - Easy Level',
                            subject: 'Mathematics',
                            difficulty: 'Easy',
                            timeLimit: 30,
                            code: 'CALC01',
                            questions: [
                                { id: 1, question: 'What is the derivative of x²?', options: ['x', '2x', 'x²', '2x²'], correctAnswer: '2x' },
                                { id: 2, question: 'What is the integral of 2x?', options: ['x²', 'x² + C', '2x²', 'x² + 2'], correctAnswer: 'x² + C' }
                            ]
                        },
                        {
                            id: 2,
                            title: 'Engineering Mechanics Test - Medium Level',
                            subject: 'Engineering Mechanics',
                            difficulty: 'Medium',
                            timeLimit: 45,
                            code: 'MECH02',
                            questions: [
                                { id: 1, question: 'What is Newton\'s second law?', options: ['F = ma', 'F = mv', 'F = mg', 'F = m/a'], correctAnswer: 'F = ma' },
                                { id: 2, question: 'What is the unit of force?', options: ['Joule', 'Newton', 'Watt', 'Pascal'], correctAnswer: 'Newton' }
                            ]
                        }
                    ];
                    
                    // Sample flash cards with enhanced features
                    this.flashcards = [
                        {
                            id: 1,
                            question: 'What is Newton\'s first law of motion?',
                            answer: 'An object at rest stays at rest, and an object in motion stays in motion, unless acted upon by an external force.',
                            difficulty: 2,
                            type: 'Physics',
                            explanation: 'This law describes the tendency of objects to resist changes in their state of motion.',
                            relatedTerms: 'Inertia, Force, Equilibrium',
                            questionImage: 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=300&fit=crop',
                            answerImage: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&h=300&fit=crop',
                            userRating: null
                        },
                        {
                            id: 2,
                            question: 'What is the formula for kinetic energy?',
                            answer: 'KE = ½mv², where m is mass and v is velocity.',
                            difficulty: 3,
                            type: 'Physics',
                            explanation: 'Kinetic energy is the energy an object possesses due to its motion.',
                            relatedTerms: 'Potential Energy, Work, Energy Conservation',
                            questionImage: 'https://images.unsplash.com/photo-1635070041408-e363dbe005cb?w=400&h=300&fit=crop',
                            answerImage: null,
                            userRating: null
                        },
                        {
                            id: 3,
                            question: 'What is the derivative of sin(x)?',
                            answer: 'cos(x)',
                            difficulty: 2,
                            type: 'Calculus',
                            explanation: 'The derivative of sine is cosine, which represents the rate of change.',
                            relatedTerms: 'Derivative, Trigonometry, Chain Rule',
                            questionImage: null,
                            answerImage: 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=300&fit=crop',
                            userRating: null
                        },
                        {
                            id: 4,
                            question: 'What is Ohm\'s law?',
                            answer: 'V = IR, where V is voltage, I is current, and R is resistance.',
                            difficulty: 1,
                            type: 'Electronics',
                            explanation: 'This fundamental law relates voltage, current, and resistance in electrical circuits.',
                            relatedTerms: 'Voltage, Current, Resistance, Circuit',
                            questionImage: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&h=300&fit=crop',
                            answerImage: null,
                            userRating: null
                        },
                        {
                            id: 5,
                            question: 'What is the first law of thermodynamics?',
                            answer: 'Energy cannot be created or destroyed, only transferred or converted from one form to another.',
                            difficulty: 3,
                            type: 'Physics',
                            explanation: 'This law states the conservation of energy principle in thermodynamic systems.',
                            relatedTerms: 'Energy Conservation, Thermodynamics, Heat',
                            questionImage: null,
                            answerImage: null,
                            userRating: null
                        }
                    ];
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
